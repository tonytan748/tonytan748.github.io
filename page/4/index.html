<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Tony Tan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Tony Tan">
<meta name="keywords" content="Tony Tan">
<meta property="og:type" content="website">
<meta property="og:title" content="Tony Tan">
<meta property="og:url" content="https://tonytan748.github.io/page/4/index.html">
<meta property="og:site_name" content="Tony Tan">
<meta property="og:description" content="Tony Tan">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Tony Tan">
<meta name="twitter:description" content="Tony Tan">
  
    <link rel="alternate" href="/atom.xml" title="Tony Tan" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Tony Tan</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">a python progrmmer</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://tonytan748.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Python支付宝接口-int-argument-must-be-a-string-a-bytes-like-object-or-a-number-not-Sequence-错误" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/11/22/Python支付宝接口-int-argument-must-be-a-string-a-bytes-like-object-or-a-number-not-Sequence-错误/" class="article-date">
  <time datetime="2021-11-22T09:49:46.000Z" itemprop="datePublished">2021-11-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/11/22/Python支付宝接口-int-argument-must-be-a-string-a-bytes-like-object-or-a-number-not-Sequence-错误/">Python支付宝接口 int() argument must be a string, a bytes-like object or a number, not &#39;Sequence&#39;错误</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>调用支付宝授权接口，公钥模式，请求结果报<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[ef2a59c2-4b73-11ec-ab9c-00163e131b46]requst sign failed. int() argument must be a string, a bytes-like object or a number, not &apos;Sequence&apos;</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/www/miniconda3/envs/ipark/lib/python3.9/site-packages/alipay/aop/api/DefaultAlipayClient.py&quot;, line 125, in __prepare_request_params</span><br><span class="line">    sign = sign_with_rsa2(self.__config.app_private_key, sign_content, self.__config.charset)</span><br><span class="line">  File &quot;/www/miniconda3/envs/ipark/lib/python3.9/site-packages/alipay/aop/api/util/SignatureUtils.py&quot;, line 49, in sign_with_rsa2</span><br><span class="line">    signature = rsa.sign(sign_content, rsa.PrivateKey.load_pkcs1(private_key, format=&apos;PEM&apos;), &apos;SHA-256&apos;)</span><br><span class="line">  File &quot;/www/miniconda3/envs/ipark/lib/python3.9/site-packages/rsa/key.py&quot;, line 124, in load_pkcs1</span><br><span class="line">    return method(keyfile)</span><br><span class="line">  File &quot;/www/miniconda3/envs/ipark/lib/python3.9/site-packages/rsa/key.py&quot;, line 592, in _load_pkcs1_pem</span><br><span class="line">    return cls._load_pkcs1_der(der)</span><br><span class="line">  File &quot;/www/miniconda3/envs/ipark/lib/python3.9/site-packages/rsa/key.py&quot;, line 527, in _load_pkcs1_der</span><br><span class="line">    key = cls(*as_ints)</span><br><span class="line">TypeError: int() argument must be a string, a bytes-like object or a number, not &apos;Sequence&apos;</span><br></pre></td></tr></table></figure></p>
<p>问题原因是生成的支付宝私钥是pkcs8格式，python不支持，需要转换为pkcs1格式</p>
<p>使用 《支付宝开发平台开发助手》的格式转换，将私钥格式转换，调用转换后的私钥即可</p>
<p>这个也适用于支付宝公钥证书模式。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2021/11/22/Python支付宝接口-int-argument-must-be-a-string-a-bytes-like-object-or-a-number-not-Sequence-错误/" data-id="cm50h3rbt007wyfhtkh4xv13f" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2021/11/22/Python支付宝接口-int-argument-must-be-a-string-a-bytes-like-object-or-a-number-not-Sequence-错误/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Python第三方字典模块：Addict-模块" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/10/23/Python第三方字典模块：Addict-模块/" class="article-date">
  <time datetime="2021-10-23T11:41:29.000Z" itemprop="datePublished">2021-10-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/10/23/Python第三方字典模块：Addict-模块/">Python第三方字典模块：Addict 模块</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>转载自<a href="https://mp.weixin.qq.com/s/j_nsJ9LH_biZPUqgHV4A_g" target="_blank" rel="noopener">这里</a></p>
<p>Addit 是一个Python模块，除了提供标准的字典语法外，Addit 生成的字典的值既可以使用属性来获取，也可以使用属性进行设置。</p>
<p>这意味着你不用再写这样的字典了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">body = &#123;</span><br><span class="line">    &apos;query&apos;: &#123;</span><br><span class="line">        &apos;filtered&apos;: &#123;</span><br><span class="line">            &apos;query&apos;: &#123;</span><br><span class="line">                &apos;match&apos;: &#123;&apos;description&apos;: &apos;addictive&apos;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &apos;filter&apos;: &#123;</span><br><span class="line">                &apos;term&apos;: &#123;&apos;created_by&apos;: &apos;Mats&apos;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相反，你只需编写以下三行代码就能完成目的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">body = Dict()</span><br><span class="line">body.query.filtered.query.match.description = &apos;addictive&apos;</span><br><span class="line">body.query.filtered.filter.term.created_by = &apos;Mats&apos;</span><br></pre></td></tr></table></figure>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>你可以通过 <code>pip</code> 安装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install addict</span><br></pre></td></tr></table></figure></p>
<p>或通过 <code>conda</code> ：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install addict -c conda-forge</span><br></pre></td></tr></table></figure></p>
<p>Addit 在Python2.7+和Python3上都可以运行。</p>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><p>Addict 继承自字典，但在访问和设置其值方面更加灵活。使用 Addict 的字典是一种乐趣！</p>
<p>设置嵌套词典的项是极其舒服的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from addict import Dict</span><br><span class="line">&gt;&gt;&gt; mapping = Dict()</span><br><span class="line">&gt;&gt;&gt; mapping.a.b.c.d.e = 2</span><br><span class="line">&gt;&gt;&gt; mapping</span><br><span class="line">&#123;&apos;a&apos;: &#123;&apos;b&apos;: &#123;&apos;c&apos;: &#123;&apos;d&apos;: &#123;&apos;e&apos;: 2&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果Dict是用任何可迭代值实例化的，它将遍历并克隆这些值，然后写入到对应的属性及值中，比如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; mapping = &#123;&apos;a&apos;: [&#123;&apos;b&apos;: 3&#125;, &#123;&apos;b&apos;: 3&#125;]&#125;</span><br><span class="line">&gt;&gt;&gt; dictionary = Dict(mapping)</span><br><span class="line">&gt;&gt;&gt; dictionary.a[0].b</span><br><span class="line">3</span><br></pre></td></tr></table></figure></p>
<p>但 <code>mapping[&#39;a&#39;]</code> 不再与 <code>dictionary[&#39;a&#39;]</code> 相同。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; mapping[&apos;a&apos;] is dictionary[&apos;a&apos;]</span><br><span class="line">False</span><br></pre></td></tr></table></figure></p>
<p>当然，此特点仅限于构造函数，而不是在使用属性或设置值时：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = Dict()</span><br><span class="line">&gt;&gt;&gt; b = [1, 2, 3]</span><br><span class="line">&gt;&gt;&gt; a.b = b</span><br><span class="line">&gt;&gt;&gt; a.b is b</span><br><span class="line">True</span><br></pre></td></tr></table></figure></p>
<h2 id="要牢记的事情"><a href="#要牢记的事情" class="headerlink" title="要牢记的事情"></a>要牢记的事情</h2><p>记住， <code>int</code> 不是有效的属性名，因此必须使用 get/setitem 语法 设置/获取 非字符串的 dict 键：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; addicted = Dict()</span><br><span class="line">&gt;&gt;&gt; addicted.a.b.c.d.e = 2</span><br><span class="line">&gt;&gt;&gt; addicted[2] = [1, 2, 3]</span><br><span class="line">&#123;2: [1, 2, 3], &apos;a&apos;: &#123;&apos;b&apos;: &#123;&apos;c&apos;: &#123;&apos;d&apos;: &#123;&apos;e&apos;: 2&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>不过，你可以随意混合使用这两种语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; addicted.a.b[&apos;c&apos;].d.e</span><br><span class="line">2</span><br></pre></td></tr></table></figure></p>
<h2 id="属性，如键、item等"><a href="#属性，如键、item等" class="headerlink" title="属性，如键、item等"></a>属性，如键、item等</h2><p>Addit 不会让你覆盖 <code>dict</code> 的属性，因此以下操作将不起作用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; mapping = Dict()</span><br><span class="line">&gt;&gt;&gt; mapping.keys = 2</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line"> File &quot;addict/addict.py&quot;, line 53, in __setattr__</span><br><span class="line"> raise AttributeError(&quot;&apos;Dict&apos; object attribute &apos;%s&apos; is read-only&quot; % name)</span><br><span class="line">AttributeError: &apos;Dict&apos; object attribute &apos;keys&apos; is read-only</span><br></pre></td></tr></table></figure></p>
<p>不过，使用下面这种方式就可以：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = Dict()</span><br><span class="line">&gt;&gt;&gt; a[&apos;keys&apos;] = 2</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">&#123;&apos;keys&apos;: 2&#125;</span><br><span class="line">&gt;&gt;&gt; a[&apos;keys&apos;]</span><br><span class="line">2</span><br></pre></td></tr></table></figure></p>
<h2 id="默认值"><a href="#默认值" class="headerlink" title="默认值"></a>默认值</h2><p>对于不在字典中的键，Addit的行为如 <code>defaultdict(Dict)</code> ，因此丢失的键返回一个空的 <code>Dict</code> 而不是抛出 <code>KeyError</code> 如果此行为不是所需的，则可以使用以下方式恢复抛出KeyError：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; class DictNoDefault(Dict):</span><br><span class="line">&gt;&gt;&gt;   def __missing__(self, key):</span><br><span class="line">&gt;&gt;&gt;     raise KeyError(key)</span><br></pre></td></tr></table></figure></p>
<p>但请注意，这样会失去速记赋值功能(<code>addicted.a.b.c.d.e = 2</code>)</p>
<h2 id="转化为普通字典"><a href="#转化为普通字典" class="headerlink" title="转化为普通字典"></a>转化为普通字典</h2><p>如果你觉得将 Addict 传递到其他函数或模块并不安全，请使用 <code>to_dict()</code> 方法，它返回会把 Addict 转化为普通字典。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; regular_dict = my_addict.to_dict()</span><br><span class="line">&gt;&gt;&gt; regular_dict.a = 2</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line"> AttributeError: &apos;dict&apos; object has no attribute &apos;a&apos;</span><br></pre></td></tr></table></figure></p>
<p>当您希望在几行代码中创建嵌套的字典，然后将其发送到不同的函数或模块时，这非常适合：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">body = Dict()</span><br><span class="line">body.query.filtered.query.match.description = &apos;addictive&apos;</span><br><span class="line">body.query.filtered.filter.term.created_by = &apos;Mats&apos;</span><br><span class="line">third_party_module.search(query=body.to_dict())</span><br></pre></td></tr></table></figure></p>
<h2 id="计数"><a href="#计数" class="headerlink" title="计数"></a>计数</h2><p><code>Dict</code> <code>轻松访问和修改深度嵌套属性的能力使其成为计数的理想选择。使用Addict，你还可以容易允许按多个级别计数，内部使用的原理是collections.Counter</code> 。</p>
<p>比如以下数据：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">data = [</span><br><span class="line">    &#123;&apos;born&apos;: 1980, &apos;gender&apos;: &apos;M&apos;, &apos;eyes&apos;: &apos;green&apos;&#125;,</span><br><span class="line">    &#123;&apos;born&apos;: 1980, &apos;gender&apos;: &apos;F&apos;, &apos;eyes&apos;: &apos;green&apos;&#125;,</span><br><span class="line">    &#123;&apos;born&apos;: 1980, &apos;gender&apos;: &apos;M&apos;, &apos;eyes&apos;: &apos;blue&apos;&#125;,</span><br><span class="line">    &#123;&apos;born&apos;: 1980, &apos;gender&apos;: &apos;M&apos;, &apos;eyes&apos;: &apos;green&apos;&#125;,</span><br><span class="line">    &#123;&apos;born&apos;: 1980, &apos;gender&apos;: &apos;M&apos;, &apos;eyes&apos;: &apos;green&apos;&#125;,</span><br><span class="line">    &#123;&apos;born&apos;: 1980, &apos;gender&apos;: &apos;F&apos;, &apos;eyes&apos;: &apos;blue&apos;&#125;,</span><br><span class="line">    &#123;&apos;born&apos;: 1981, &apos;gender&apos;: &apos;M&apos;, &apos;eyes&apos;: &apos;blue&apos;&#125;,</span><br><span class="line">    &#123;&apos;born&apos;: 1981, &apos;gender&apos;: &apos;F&apos;, &apos;eyes&apos;: &apos;green&apos;&#125;,</span><br><span class="line">    &#123;&apos;born&apos;: 1981, &apos;gender&apos;: &apos;M&apos;, &apos;eyes&apos;: &apos;blue&apos;&#125;,</span><br><span class="line">    &#123;&apos;born&apos;: 1981, &apos;gender&apos;: &apos;F&apos;, &apos;eyes&apos;: &apos;blue&apos;&#125;,</span><br><span class="line">    &#123;&apos;born&apos;: 1981, &apos;gender&apos;: &apos;M&apos;, &apos;eyes&apos;: &apos;green&apos;&#125;,</span><br><span class="line">    &#123;&apos;born&apos;: 1981, &apos;gender&apos;: &apos;F&apos;, &apos;eyes&apos;: &apos;blue&apos;&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>如果你想计算有多少人出生在born性别的gender使用eyes眼睛，你可以很容易地计算出这些信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">counter = Dict()</span><br><span class="line"></span><br><span class="line">for row in data:</span><br><span class="line">    born = row[&apos;born&apos;]</span><br><span class="line">    gender = row[&apos;gender&apos;]</span><br><span class="line">    eyes = row[&apos;eyes&apos;]</span><br><span class="line"></span><br><span class="line">    counter[born][gender][eyes] += 1 print(counter)</span><br><span class="line"></span><br><span class="line"># 结果：&#123;1980: &#123;&apos;M&apos;: &#123;&apos;blue&apos;: 1, &apos;green&apos;: 3&#125;, &apos;F&apos;: &#123;&apos;blue&apos;: 1, &apos;green&apos;: 1&#125;&#125;, 1981: &#123;&apos;M&apos;: &#123;&apos;blue&apos;: 2, &apos;green&apos;: 1&#125;, &apos;F&apos;: &#123;&apos;blue&apos;: 2, &apos;green&apos;: 1&#125;&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><p>普通字典的更新方式如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d = &#123;&apos;a&apos;: &#123;&apos;b&apos;: 3&#125;&#125;</span><br><span class="line">&gt;&gt;&gt; d.update(&#123;&apos;a&apos;: &#123;&apos;c&apos;: 4&#125;&#125;)</span><br><span class="line">&gt;&gt;&gt; print(d)</span><br><span class="line">&#123;&apos;a&apos;: &#123;&apos;c&apos;: 4&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p> <code>addict</code> 的更新方式如下，它会递归并实际更新嵌套的字典：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; D = Dict(&#123;&apos;a&apos;: &#123;&apos;b&apos;: 3&#125;&#125;)</span><br><span class="line">&gt;&gt;&gt; D.update(&#123;&apos;a&apos;: &#123;&apos;c&apos;: 4&#125;&#125;)</span><br><span class="line">&gt;&gt;&gt; print(D)</span><br><span class="line">&#123;&apos;a&apos;: &#123;&apos;b&apos;: 3, &apos;c&apos;: 4&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Addict-是怎么来的？"><a href="#Addict-是怎么来的？" class="headerlink" title="Addict 是怎么来的？"></a>Addict 是怎么来的？</h2><p>这个模块完全是从用Python创建Elasticsearch查询的繁琐过程中发展而来的。每当你发现自己在写了很复杂的字典逻辑时，只要记住你没有必要这样做，使用 Addict 就行。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2021/10/23/Python第三方字典模块：Addict-模块/" data-id="cm50h3rbz0083yfht9woj9ju5" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2021/10/23/Python第三方字典模块：Addict-模块/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Huey-as-a-minimal-task-queue-for-Django" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/09/13/Huey-as-a-minimal-task-queue-for-Django/" class="article-date">
  <time datetime="2021-09-13T03:30:19.000Z" itemprop="datePublished">2021-09-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/django/">django</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/09/13/Huey-as-a-minimal-task-queue-for-Django/">Huey as a minimal task queue for Django</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This blog transfer from <a href="https://www.untangled.dev/2020/07/01/huey-minimal-task-queue-django/" target="_blank" rel="noopener">here</a></p>
<p>Are you considering adding a task queue to your Django project? Then this article should be useful to you.</p>
<p>When I was “younger” task queue with Django project meant celery task queue.</p>
<p>Now that I’m “older” there are simpler alternatives. The simplest I found was Huey. But the ideas presented here apply to evaluating all task queues for your Django project.</p>
<h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><h3 id="Frustrated-with-celery-and-django-celery"><a href="#Frustrated-with-celery-and-django-celery" class="headerlink" title="Frustrated with celery and django-celery"></a>Frustrated with celery and django-celery</h3><p>In December 2019 I was taking a Django project from Python 2 to 3. This project relied on celery and its integration for Django for asynchronous task processing. Github project link here. This codebase’s work was mostly done back in 2012-2015.</p>
<p><code>django-celery</code> was the first problematic part. “Problematic” because it was not being actively maintained. Python 3 support was only “planned” at the time.</p>
<p>Besides, by testing celery with my Python3 setup I realised how “heavy” it is. “Heavy” in terms of dependencies. <code>billiard</code>, <code>kombu</code>, etc.</p>
<p>I had used <code>celery</code> for a very long time. A decade! But this nudged me into looking for alternatives.</p>
<p>My use cases for using an async task queue were:</p>
<ul>
<li>Handle tasks async. For example, sending an email out. Tasks that you should not handle within the request-response cycle.</li>
<li>Scheduled tasks.</li>
<li>Retrying of failed tasks. For example, reading from an API fails due to a network error. I want that task retried for a few times.</li>
<li>Simple locking. More on what I mean by “simple” further down.</li>
</ul>
<p>The above were (are) handled nicely by <code>celery</code>. The scheduled tasks part relied entirely on <code>django-celery</code>.</p>
<p>Another factor that pushed me “off the celery train” was something in my last long-term gig. The increasing reputation that celery is “heavyweight”.</p>
<p>Finally, celery provides a whole lot more than the above basic set of use cases I need.</p>
<h3 id="Is-celery-heavyweight"><a href="#Is-celery-heavyweight" class="headerlink" title="Is celery heavyweight?"></a>Is celery heavyweight?</h3><p>A colleague achieved significant gains in task execution time by moving off celery. To dramatiq. This was on a Python 3 project I didn’t work directly on. By significant I mean ~50% throughput. In this case, “tasks” were about handling a simple message that wrote one row to the database, at most. With no real processing of that message.</p>
<p>At about the same time the above happened, I was listening to the DjangoChat podcast.</p>
<p>The below is a transcript from the “Caching” episode from November 2019. Transcript here. The podcast folks were discussing caches. And brought up the usual suspects; Memcached and Redis. On mentioning Redis, Carlton Gibson calls out how easy it is to add a queue when you have Redis in place. And how much of an “overkill” celery is. Emphaisis in the below quote is mine:</p>
<blockquote>
<p>have Redis? Yeah. You want to you want to use a queue. So let’s take a good queue package. So, you know, everyone always talks about celery, but celery is overkill for, you know, the majority of use cases. So what’s a good package? Well, there’s one called django-q, which I love and have fun with. That’s nice and simple. And that’s got a Redis back end. So you pip install, right or, you know, apt install Redis. And then you pip install django-q into your project, you know, a little bit of settings, magic, and you’re up and running [..]</p>
</blockquote>
<h3 id="Packages-Considered"><a href="#Packages-Considered" class="headerlink" title="Packages Considered"></a>Packages Considered</h3><p>I did not compare packages. To compare would mean installing each one, run the same task and measure. I had what was left of a “free” day to switch over from celery to another package and have things deployed by day’s end.</p>
<p>I considered these packages to see if I could adopt a more lightweight alternative to celery. Before I continue, by “lightweight” I mean, “lightweight in terms of”:</p>
<ul>
<li>package size and dependencies</li>
<li>code that I would need to rework to transition from celery to this task queue</li>
<li>works with Redis, a pre-existing component in my stack</li>
</ul>
<p>The packages I <del>compared</del> considered:</p>
<table>
<thead>
<tr>
<th>Package</th>
<th>Link</th>
<th>How I got to know about it</th>
</tr>
</thead>
<tbody>
<tr>
<td>dramatiq</td>
<td><a href="https://dramatiq.io/" target="_blank" rel="noopener">Link</a></td>
<td>Ex-colleague’s experience, described above.</td>
</tr>
<tr>
<td>django-q</td>
<td><a href="https://django-q.readthedocs.io/en/latest/" target="_blank" rel="noopener">Link</a></td>
<td>Recommended during the DjangoChat podcast.</td>
</tr>
<tr>
<td>huey</td>
<td><a href="https://huey.readthedocs.io/en/latest/" target="_blank" rel="noopener">Link</a></td>
<td>Recommended by Adam Johnson, Django blogger I follow.</td>
</tr>
</tbody>
</table>
<p>I decided to move on with <code>Huey</code>. It was not a clear-cut decision.</p>
<p>My mindset was not about installing the best. It was about installing a minimal package. That removes my dependency on celery/django-celery. And allows me to continue taking that project’s codebase to Python 3.</p>
<p>Why not <code>dramatiq</code>? I did not go with <code>dramatiq</code> because of two reasons:</p>
<ul>
<li>It required installation of another package. The “Advanced Python Scheduler”, APS, to allow scheduling of tasks.</li>
<li><code>django-dramatiq</code>, while maintained by the author of <code>dramatiq</code> itself, is “yet another package”.</li>
</ul>
<p>After my experience with <code>django-celery</code> any extra package scared me. I did not want to end up being unable to use a main library due to a smaller accompanying library not being maintained.</p>
<p>In comparison, for <code>Huey</code> I would only need to <code>pip install huey</code>. The Django integration part is part of the package. Docs <a href="https://huey.readthedocs.io/en/latest/django.html" target="_blank" rel="noopener">here</a>.</p>
<p>In addition, dramatiq is intended for rabbitmq. I see no need for advanced messaging such as that enabled by rabbitmq right now.1</p>
<p>Why not <code>django-q</code>? It is actively maintained. And targeted for Django. And offers a lot of features. But by the looks of it, it offered many features I was not going to be using. At the cost of being less lightweight than <code>Huey</code>.</p>
<p>The above does not mean <code>dramatiq</code> or <code>django-q</code> are not great packages. Far from it. I have them in mind in case the use case changes.</p>
<h2 id="Huey"><a href="#Huey" class="headerlink" title="Huey"></a>Huey</h2><p><a href="https://huey.readthedocs.io/en/latest/django.html" target="_blank" rel="noopener">Huey’s Django integration</a> provides:</p>
<ul>
<li>Configuration of huey via the Django settings module.</li>
<li>Running the consumer as a Django management command.</li>
<li>Auto-discovery of tasks.py modules to simplify task importing.</li>
<li>Properly manage database connections.</li>
</ul>
<p>Sweet.</p>
<h3 id="Code-changes"><a href="#Code-changes" class="headerlink" title="Code changes"></a>Code changes</h3><p>Installed <code>huey</code>? The <a href="https://huey.readthedocs.io/en/latest/django.html#setting-things-up" target="_blank" rel="noopener">Setting Things Up</a> section in Huey’s Django integration guide covers what you need to do from then on.</p>
<p>Instead of importing the <code>task</code> or <code>periodic_task</code> decorators from the main Huey package, import from <code>huey.contrib.djhuey</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from huey.contrib.djhuey import periodic_task, task</span><br></pre></td></tr></table></figure>
<p>Huey also <a href="https://huey.readthedocs.io/en/latest/django.html#tasks-that-execute-queries" target="_blank" rel="noopener">offers function decorators for tasks that execute queries</a>, which automatically close the database connection:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from huey.contrib.djhuey import db_periodic_task, db_task</span><br></pre></td></tr></table></figure>
<p>To set a task performing a <code>db_task</code> therefore:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from huey.contrib import djhuey as huey</span><br><span class="line"></span><br><span class="line">@huey.db_task()</span><br><span class="line">def save_data_and_send_email():</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>What about settings files? Main settings:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># HUEY</span><br><span class="line">HUEY = &#123;</span><br><span class="line">    &apos;name&apos;: &apos;mydjangoproject&apos;,</span><br><span class="line">    &apos;url&apos;: &apos;redis://localhost:6379/?db=1&apos;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Seriously, that’s enough to have things running!</p>
<p>A note about how things run locally by default:</p>
<blockquote>
<p>When <code>settings.DEBUG = True</code>, tasks will be executed synchronously just like regular function calls. The purpose of this is to avoid running both Redis and an additional consumer process while developing or running tests.</p>
</blockquote>
<p>This is probably the reason why <code>run_huey</code> doesn’t autoreload.</p>
<p>To have Huey use redis to broker tasks locally:</p>
<ul>
<li>ensure <code>redis</code> service is available locally (duh!)</li>
<li>set <code>immediate</code> and <code>immediate_use_memory</code> to <code>False</code>:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HUEY[&apos;immediate_use_memory&apos;] = False</span><br><span class="line">HUEY[&apos;immediate&apos;] = False</span><br></pre></td></tr></table></figure>
<p>More details on debug and synchronous execution with Huey <a href="https://huey.readthedocs.io/en/latest/django.html#debug-and-synchronous-execution" target="_blank" rel="noopener">here</a>.</p>
<h3 id="Passing-Parameters"><a href="#Passing-Parameters" class="headerlink" title="Passing Parameters"></a>Passing Parameters</h3><p>Note that, like in celery’s case, Huey uses <code>pickle</code> to serialize messages (<a href="https://docs.python.org/3/library/pickle.html" target="_blank" rel="noopener">docs</a>).</p>
<p>So pay attention to pass variable types that play well with <code>pickle</code> when passing parameters.</p>
<p>Thus avoid passing a Django model instance or queryset as parameter, as shown below:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from huey.contrib import djhuey as huey</span><br><span class="line"></span><br><span class="line">@huey.task()</span><br><span class="line">def notify_user(user):</span><br><span class="line">    send_email(user.email, ...)</span><br><span class="line"></span><br><span class="line">my_user = User.objects.get(id=user_id)</span><br><span class="line">send_email(my_user)()  # enqueue task</span><br></pre></td></tr></table></figure>
<p>Instead pass the object <code>id</code>, which is an <code>int</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from huey.contrib import djhuey as huey</span><br><span class="line"></span><br><span class="line">@huey.task()</span><br><span class="line">def notify_user(user_id):</span><br><span class="line">    user = User.objects.get(id=user_id)</span><br><span class="line">    send_email(user.email, ...)</span><br><span class="line"></span><br><span class="line">send_email(my_user.id)()  # enqueue task</span><br></pre></td></tr></table></figure>
<p>The serializer can be overridden. But going into that takes us beyond minimal for today.</p>
<h3 id="Periodic-tasks"><a href="#Periodic-tasks" class="headerlink" title="Periodic tasks"></a>Periodic tasks</h3><p>This is an example of a periodic task. It calls a Django management command to clear expired user sessions every 2 hours:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from huey import crontab</span><br><span class="line">from huey.contrib import djhuey as huey</span><br><span class="line"></span><br><span class="line">@huey.periodic_task(crontab(hour=&apos;*/2&apos;))</span><br><span class="line">def clear_expired_sessions():</span><br><span class="line">    from django.core.management import call_command</span><br><span class="line">    return call_command(&apos;clearsessions&apos;)</span><br></pre></td></tr></table></figure>
<p>One minimal aspect of Django+Huey is when it comes to deployment (tackled further down).</p>
<p><code>manage.py run_huey</code> takes care of executing both:</p>
<ul>
<li>tasks that your code adds to the queue while it’s running, e.g. send an email triggered by a user action</li>
<li>scheduled (aka “periodic”) tasks</li>
</ul>
<p>Both the task <code>consumer</code> and <code>scheduler</code> are run by the same <code>run_huey</code> process.</p>
<h3 id="Retries"><a href="#Retries" class="headerlink" title="Retries"></a>Retries</h3><p>Example: I want to fetch API data on the first of the month at 2:30PM:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from huey import crontab</span><br><span class="line">from huey.contrib import djhuey as huey</span><br><span class="line"></span><br><span class="line">@huey.db_periodic_task(</span><br><span class="line">    crontab(day=&apos;1&apos;, hour=&apos;14&apos;, minute=&apos;30&apos;),</span><br><span class="line">    retries=2, retry_delay=10)</span><br><span class="line">@huey.lock_task(&apos;sync_gsuite_data&apos;)</span><br><span class="line">def fetch_api_data():</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>The above retries the function twice, with an interval of 10 seconds.</p>
<p>The one aspect that’s missing in this setup is a hook to retry only in case of specific exception. I want an exception caused by a network error to be retried. But not an exception due to a <code>ZeroDivisionError</code>, for example.</p>
<p><code>huey</code> provides signals that allow you to inspect an exception on various types of events. For example, you could use the below code to notify admins when a Huey task fails without being retried:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import traceback</span><br><span class="line"></span><br><span class="line">from django.core.mail import mail_admins</span><br><span class="line"></span><br><span class="line">from huey import signals</span><br><span class="line">from huey.contrib import djhuey as huey</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@huey.signal(signals.SIGNAL_ERROR)</span><br><span class="line">def task_error(signal, task, exc):</span><br><span class="line">    if task.retries &gt; 0:</span><br><span class="line">        return  # do not notify when task is to be retried</span><br><span class="line">    subject = f&apos;Task [&#123;task.name&#125;] failed&apos;</span><br><span class="line">    message = f&quot;&quot;&quot;Task ID: &#123;task.id&#125;</span><br><span class="line">Args: &#123;task.args&#125;</span><br><span class="line">Kwargs: &#123;task.kwargs&#125;</span><br><span class="line">Exception: &#123;exc&#125;</span><br><span class="line">&#123;traceback.format_exc()&#125;&quot;&quot;&quot;</span><br><span class="line">    mail_admins(subject, message)</span><br></pre></td></tr></table></figure>
<p>Sidenote 1: Keep in mind signals are executed synchronously by the consumer as it processes tasks.</p>
<p>Sidenote 2: this is just to demonstrate what can be done. A more standard way to do this is to attach an email handler at loglevel <code>ERROR</code> to the huey consumer logger.</p>
<p>But I would prefer the hook that <code>dramatiq</code> provides to determine whether a task should be retried in this style:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def should_retry(retries_so_far, exception):</span><br><span class="line">    return retries_so_far &lt; 3 and isinstance(exception, HttpTimeout)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@dramatiq.actor(retry_when=should_retry)</span><br><span class="line">def count_words(url):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>See? I’m veering off “minimal” and into better features. Let’s move on.</p>
<h3 id="Simple-locking"><a href="#Simple-locking" class="headerlink" title="Simple locking"></a>Simple locking</h3><p>To quote <code>huey’s</code> author <a href="https://github.com/coleifer/huey/issues/413#issuecomment-488794415" target="_blank" rel="noopener">himself</a>:</p>
<blockquote>
<p>A simple lock ensures that one task cannot be executed in parallel.</p>
</blockquote>
<p>Example use case: a report generation task that runs every 10 minutes, but occasionally it can take 15 minutes to complete. You want to ensure that it does not start a stampede. So you use a lock to ensure that only one instance of the task can run at a time.</p>
<p>Example code from <code>huey</code>’s docs on <a href="https://huey.readthedocs.io/en/latest/guide.html#locking-tasks" target="_blank" rel="noopener">locking tasks</a>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@huey.periodic_task(crontab(minute=&apos;*/10&apos;))</span><br><span class="line">@huey.lock_task(&apos;reports-lock&apos;)  # Goes *after* the task decorator.</span><br><span class="line">def generate_report():</span><br><span class="line">    run_report()</span><br></pre></td></tr></table></figure>
<h3 id="Take-a-look-around"><a href="#Take-a-look-around" class="headerlink" title="Take a look around"></a>Take a look around</h3><p>A nice thing about Huey is its <a href="https://huey.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener">docs</a>. Being a relatively small package, you don’t easily get lost.</p>
<p>The docs feel “cohesive”. Unlike how I used to feel with celery’s docs. So feel free to take a look around for other features not mentioned in this tutorial.</p>
<p>The <a href="https://huey.readthedocs.io/en/latest/troubleshooting.html" target="_blank" rel="noopener">troubleshooting and common pitfalls</a> section saved me a headscratch or two.</p>
<h2 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h2><p>In my Ubuntu setup I use <a href="http://supervisord.org/" target="_blank" rel="noopener">supervisor</a> for process management. For example supervisor manages the <code>gunicorn</code> which binds the Django application to Nginx.</p>
<h3 id="The-bash-scipt"><a href="#The-bash-scipt" class="headerlink" title="The bash scipt"></a>The bash scipt</h3><p>To run Huey, supervisor runs a bash script that runs Huey:</p>
<p>start_huey.bash<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">NAME=&quot;mydjangoproject-huey&quot;  # Name of the application</span><br><span class="line">DJANGODIR=/home/ubuntu/webapp/mydjangoproject/proj  # Django project directory</span><br><span class="line">DJANGOENVDIR=/home/ubuntu/webapp/mydjangoproject_env  # Django project virtualenv</span><br><span class="line"></span><br><span class="line">echo &quot;Starting $NAME as `whoami`&quot;</span><br><span class="line"></span><br><span class="line"># Activate the virtual environment</span><br><span class="line">cd $DJANGODIR</span><br><span class="line">source /home/ubuntu/webapp/mydjangoproject_env/bin/activate</span><br><span class="line">source /home/ubuntu/webapp/mydjangoproject/proj/.env</span><br><span class="line">export PYTHONPATH=$DJANGODIR:$PYTHONPATH</span><br><span class="line"></span><br><span class="line"># Start Huey</span><br><span class="line">exec $&#123;DJANGOENVDIR&#125;/bin/python manage.py run_huey</span><br></pre></td></tr></table></figure></p>
<p>Test the bash script above by running it.</p>
<p>It has to be executable, i.e. <code>chmod +x start_huey.bash</code> if it’s not.</p>
<p>Output should be similar to this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Starting mydjangoproject-huey as ubuntu</span><br><span class="line">[2020-07-01 16:26:54,455] INFO:huey.consumer:MainThread:Huey consumer started with 1 thread, PID 12113 at 2020-07-01 14:26:54.455715</span><br><span class="line">[2020-07-01 16:26:54,456] INFO:huey.consumer:MainThread:Scheduler runs every 1 second(s).</span><br><span class="line">[2020-07-01 16:26:54,456] INFO:huey.consumer:MainThread:Periodic tasks are enabled.</span><br><span class="line">[2020-07-01 16:26:54,456] INFO:huey.consumer:MainThread:The following commands are available:</span><br><span class="line">+ myapp.tasks.send_email</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<h3 id="supervisor-conf-file"><a href="#supervisor-conf-file" class="headerlink" title="supervisor conf file"></a>supervisor conf file</h3><p>File located at: <code>/etc/supervisor/conf.d/huey.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">; ================================</span><br><span class="line">;  huey supervisor</span><br><span class="line">; ================================</span><br><span class="line"></span><br><span class="line">[program:huey]</span><br><span class="line">command = /home/ubuntu/webapp/start_huey.bash  ; Command to start huey</span><br><span class="line"></span><br><span class="line">user=ubuntu</span><br><span class="line">numprocs=1</span><br><span class="line">stdout_logfile=/home/ubuntu/webapp/logs/huey/worker.log</span><br><span class="line">stderr_logfile=/home/ubuntu/webapp/logs/huey/error.log</span><br><span class="line">stdout_logfile_maxbytes=50MB</span><br><span class="line">stderr_logfile_maxbytes=50MB</span><br><span class="line">stdout_logfile_backups=10</span><br><span class="line">stderr_logfile_backups=10</span><br><span class="line">autostart=true</span><br><span class="line">autorestart=true</span><br><span class="line">startsecs=10</span><br><span class="line"></span><br><span class="line">; Need to wait for currently executing tasks to finish at shutdown.</span><br><span class="line">; Increase this if you have very long running tasks.</span><br><span class="line">stopwaitsecs = 2</span><br><span class="line"></span><br><span class="line">; Causes supervisor to send the termination signal (SIGTERM) to the whole process group.</span><br><span class="line">stopasgroup=true</span><br></pre></td></tr></table></figure>
<p>A lot of the <code>conf</code> file above is supervisor-specific.</p>
<p>The point of this section is to show you how simple it is to have <code>huey</code> with Django run reliably on an Ubuntu instance.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2021/09/13/Huey-as-a-minimal-task-queue-for-Django/" data-id="cm50h3rc30089yfhtbezqg5rf" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2021/09/13/Huey-as-a-minimal-task-queue-for-Django/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/django/">django</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-用python绘制太极图" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/09/10/用python绘制太极图/" class="article-date">
  <time datetime="2021-09-10T03:13:18.000Z" itemprop="datePublished">2021-09-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/09/10/用python绘制太极图/">用python绘制太极图</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>不多说，直接上代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import turtle as t</span><br><span class="line"></span><br><span class="line">t.setup(800, 800, 0, 0)</span><br><span class="line">t.pensize(1.5)</span><br><span class="line">t.pu()</span><br><span class="line">t.goto(0,-300)</span><br><span class="line">t.pd()</span><br><span class="line"></span><br><span class="line">t.fillcolor(&quot;black&quot;)</span><br><span class="line">t.begin_fill()</span><br><span class="line">t.circle(300, -180)</span><br><span class="line">t.circle(150, -180)</span><br><span class="line">t.circle(150, -180)</span><br><span class="line">t.end_fill()</span><br><span class="line"></span><br><span class="line">t.circle(-300, -180)</span><br><span class="line"></span><br><span class="line">t.fillcolor(&quot;white&quot;)</span><br><span class="line">t.begin_fill()</span><br><span class="line">t.pu()</span><br><span class="line">t.goto(0, 120)</span><br><span class="line">t.pd()</span><br><span class="line">t.circle(37.5)</span><br><span class="line">t.end_fill()</span><br><span class="line"></span><br><span class="line">t.fillcolor(&quot;black&quot;)</span><br><span class="line">t.begin_fill()</span><br><span class="line">t.pu()</span><br><span class="line">t.goto(0, -120)</span><br><span class="line">t.pd()</span><br><span class="line">t.circle(-37.5)</span><br><span class="line">t.end_fill()</span><br></pre></td></tr></table></figure>
<p>主要是运用turtle插件，研究下，自己结婚的时候不会被难住了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2021/09/10/用python绘制太极图/" data-id="cm50h3rbp007ryfhtcklch1t7" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2021/09/10/用python绘制太极图/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-OS-X下运行sudo-go-command" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/09/09/OS-X下运行sudo-go-command/" class="article-date">
  <time datetime="2021-09-09T10:54:11.000Z" itemprop="datePublished">2021-09-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/other/">other</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/09/09/OS-X下运行sudo-go-command/">MAC下运行go command必须要sudo的处理办法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>自己mac电脑上运行go项目时需要sudo权限才能操作。如果没有sudo则报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command not found: go</span><br></pre></td></tr></table></figure>
<p>原因时账号没有root权限</p>
<p>修改<code>/etc/sudoers</code>文件配置，顺利解决该问题:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo visudo</span><br></pre></td></tr></table></figure>
<p>找到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root        ALL = (ALL) ALL</span><br></pre></td></tr></table></figure></p>
<p>复制一行，将<code>root</code>改为自己的账号名，保存即可</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2021/09/09/OS-X下运行sudo-go-command/" data-id="cm50h3rbj007kyfhtnf9d53o4" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2021/09/09/OS-X下运行sudo-go-command/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/other/">other</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-互联网架构，如何进行容量设计？" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/01/互联网架构，如何进行容量设计？/" class="article-date">
  <time datetime="2021-08-01T11:11:06.000Z" itemprop="datePublished">2021-08-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/other/">other</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/01/互联网架构，如何进行容量设计？/">互联网架构，如何进行容量设计？</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>文章转载自<a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651959542&amp;idx=1&amp;sn=2494bbea9a855e0e1c3ccd6d2562a600&amp;scene=0#rd" target="_blank" rel="noopener">这里</a></p>
<h2 id="一，需求缘起"><a href="#一，需求缘起" class="headerlink" title="一，需求缘起"></a>一，需求缘起</h2><p>互联网公司，这样的场景是否似曾相识：</p>
<p>场景一：pm要做一个很大的运营活动，技术老大杀过来，问了两个问题：</p>
<p>（1）机器能抗住么？</p>
<p>（2）如果扛不住，需要加多少台机器？</p>
<p>场景二：系统设计阶段，技术老大杀过来，又问了两个问题：</p>
<p>（1）数据库需要分库么？</p>
<p>（2）如果需要分库，需要分几个库？</p>
<p>技术上来说，这些都是系统容量预估的问题，容量设计是架构师必备的技能之一。常见的容量评估包括数据量、并发量、带宽、CPU/MEM/DISK等，今天分享的内容，就以【并发量】为例，看看如何回答好这两个问题。</p>
<h2 id="二，容量评估的步骤与方法"><a href="#二，容量评估的步骤与方法" class="headerlink" title="二，容量评估的步骤与方法"></a>二，容量评估的步骤与方法</h2><p>【步骤一：评估总访问量】</p>
<p>如何知道总访问量？对于一个运营活动的访问量评估，或者一个系统上线后PV的评估，有什么好的方法？</p>
<p>答案是：询问业务方，询问运营同学，询问产品同学，看对运营活动或者产品上线后的预期是什么。</p>
<p>举例：58要做一个APP-push的运营活动，计划在30分钟内完成5000w用户的push推送，预计push消息点击率10%，求push落地页系统的总访问量？</p>
<p>回答：<code>5000w*10% = 500w</code></p>
<p>【步骤二：评估平均访问量QPS】</p>
<p>如何知道平均访问量QPS？</p>
<p>答案是：有了总量，除以总时间即可，如果按照天评估，一天按照4w秒计算。</p>
<p>举例1：push落地页系统30分钟的总访问量是500w，求平均访问量QPS</p>
<p>回答：<code>500w/(30*60) = 2778，大概3000QPS</code></p>
<p>举例2：主站首页估计日均pv 8000w，求平均访问QPS</p>
<p>回答：一天按照4w秒算，8000w/4w=2000，大概2000QPS</p>
<p>提问：为什么一天按照4w秒计算？</p>
<p>回答：一天共<code>24小时*60分钟*60秒=8w秒</code>，一般假设所有请求都发生在白天，所以一般来说一天只按照4w秒评估</p>
<p>【步骤三：评估高峰QPS】</p>
<p>系统容量规划时，不能只考虑平均QPS，而是要抗住高峰的QPS，如何知道高峰QPS呢？</p>
<p>答案是：根据业务特性，通过业务访问曲线评估</p>
<p>举例：日均QPS为2000，业务访问趋势图如下图，求峰值QPS预估？</p>
<p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxczfXmIbibeElVSyejm94IVGW27GbsibXTG7r3jicMoMnZhl3gXLtbyYZSQ2A1aRuHawUGgPgZeib50g/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>回答：从图中可以看出，峰值QPS大概是均值QPS的2.5倍，日均QPS为2000，于是评估出峰值QPS为5000。</p>
<p>说明：有一些业务例如“秒杀业务”比较难画出业务访问趋势图，这类业务的容量评估不在此列。</p>
<p>【步骤四：评估系统、单机极限QPS】</p>
<p>如何评估一个业务，一个服务单机能的极限QPS呢？</p>
<p>答案是：压力测试</p>
<p>在一个服务上线前，一般来说是需要进行压力测试的（很多创业型公司，业务迭代很快的系统可能没有这一步，那就悲剧了），以APP-push运营活动落地页为例（日均QPS2000，峰值QPS5000），这个系统的架构可能是这样的：</p>
<p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxczfXmIbibeElVSyejm94IVg2icic0NINcKROXhl3DULNmiboVH4z43wyyQ2IFyEWic43KDFgPcbUoS7Q/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片2"></p>
<p>1）访问端是APP</p>
<p>2）运营活动H5落地页是一个web站点</p>
<p>3）H5落地页由缓存cache、数据库db中的数据拼装而成</p>
<p>通过压力测试发现，web层是瓶颈，tomcat压测单机只能抗住1200的QPS（一般来说，1%的流量到数据库，数据库500QPS还是能轻松抗住的，cache的话QPS能抗住，需要评估cache的带宽，假设不是瓶颈），我们就得到了web单机极限的QPS是1200。一般来说，线上系统是不会跑满到极限的，打个8折，单机线上允许跑到QPS1000。</p>
<p>【步骤五：根据线上冗余度回答两个问题】</p>
<p>好了，上述步骤1-4已经得到了峰值QPS是5000，单机QPS是1000，假设线上部署了2台服务，就能自信自如的回答技术老大提出的问题了：</p>
<p>（1）机器能抗住么？ -&gt; 峰值5000，单机1000，线上2台，扛不住</p>
<p>（2）如果扛不住，需要加多少台机器？ -&gt; 需要额外3台，提前预留1台更好，给4台更稳</p>
<p>除了并发量的容量预估，数据量、带宽、CPU/MEM/DISK等评估亦可遵循类似的步骤。</p>
<h2 id="三，总结"><a href="#三，总结" class="headerlink" title="三，总结"></a>三，总结</h2><p>互联网架构设计如何进行容量评估：</p>
<p>【步骤一：评估总访问量】 -&gt; 询问业务、产品、运营</p>
<p>【步骤二：评估平均访问量QPS】-&gt; 除以时间，一天算4w秒</p>
<p>【步骤三：评估高峰QPS】 -&gt; 根据业务曲线图来</p>
<p>【步骤四：评估系统、单机极限QPS】 -&gt; 压测很重要</p>
<p>【步骤五：根据线上冗余度回答两个问题】 -&gt; 估计冗余度与线上冗余度差值</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2021/08/01/互联网架构，如何进行容量设计？/" data-id="cm50h3rbv007zyfht4da4navk" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2021/08/01/互联网架构，如何进行容量设计？/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/other/">other</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-freeswitch在centos中安装" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/05/30/freeswitch在centos中安装/" class="article-date">
  <time datetime="2021-05-30T08:18:30.000Z" itemprop="datePublished">2021-05-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/freeswitch/">freeswitch</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/05/30/freeswitch在centos中安装/">freeswitch在centos中安装</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="下载freeswitch包"><a href="#下载freeswitch包" class="headerlink" title="下载freeswitch包"></a>下载freeswitch包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://freeswitch.org/confluence/display/FREESWITCH/FreeSWITCH+1.10.x+Release+notes</span><br></pre></td></tr></table></figure>
<p>找到最新安装包<code>for centos</code></p>
<h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y git alsa-lib-devel autoconf automake bison broadvoice-devel bzip2 curl-devel libdb4-devel e2fsprogs-devel erlang flite-devel g722_1-devel gcc-c++ gdbm-devel gnutls-devel ilbc2-devel ldns-devel libcodec2-devel libcurl-devel libedit-devel libidn-devel libjpeg-devel libmemcached-devel libogg-devel libsilk-devel libsndfile-devel libtheora-devel libtiff-devel libtool libuuid-devel libvorbis-devel libxml2-devel lua-devel lzo-devel mongo-c-driver-devel ncurses-devel net-snmp-devel openssl-devel opus-devel pcre-devel perl perl-ExtUtils-Embed pkgconfig portaudio-devel postgresql-devel python-devel python-devel soundtouch-devel speex-devel sqlite-devel unbound-devel unixODBC-devel wget which yasm zlib-devel libshout-devel libmpg123-devel lame-devel</span><br></pre></td></tr></table></figure>
<h2 id="安装cmake"><a href="#安装cmake" class="headerlink" title="安装cmake"></a>安装cmake</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum remove cmake #卸载yum安装的版本，若无安装则忽略</span><br><span class="line">cd /usr/local/src</span><br><span class="line">wget https://cmake.org/files/v3.14/cmake-3.14.0.tar.gz</span><br><span class="line">tar vzxf cmake-3.14.0.tar.gz</span><br><span class="line">cd cmake-3.14.0</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h2 id="安装libks"><a href="#安装libks" class="headerlink" title="安装libks"></a>安装libks</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/src</span><br><span class="line">yum install libatomic</span><br><span class="line">git clone https://github.com/signalwire/libks.git</span><br><span class="line">cd libks</span><br><span class="line">cmake .</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h2 id="安装signalwire-c"><a href="#安装signalwire-c" class="headerlink" title="安装signalwire-c"></a>安装signalwire-c</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/src</span><br><span class="line">git clone https://github.com/signalwire/signalwire-c.git</span><br><span class="line">cd signalwire-c/</span><br><span class="line">cmake .</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">ln -sf /usr/local/lib64/pkgconfig/signalwire_client.pc /usr/lib64/pkgconfig/signalwire_client.pc</span><br></pre></td></tr></table></figure>
<h2 id="编译x264"><a href="#编译x264" class="headerlink" title="编译x264"></a>编译x264</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone http://git.videolan.org/git/x264.git</span><br><span class="line">./configure –disable-asm</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h2 id="编译安装mod-av"><a href="#编译安装mod-av" class="headerlink" title="编译安装mod_av"></a>编译安装mod_av</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">wget http://download1.rpmfusion.org/free/el/updates/7/x86_64/x/x264-libs-0.148-24.20170521gitaaa9aa8.el7.x86_64.rpm</span><br><span class="line">wget http://download1.rpmfusion.org/free/el/updates/7/x86_64/x/x264-devel-0.148-24.20170521gitaaa9aa8.el7.x86_64.rpm</span><br><span class="line">rpm -hiv x264-libs-0.148-24.20170521gitaaa9aa8.el7.x86_64.rpm</span><br><span class="line">rpm -hiv x264-devel-0.148-24.20170521gitaaa9aa8.el7.x86_64.rpm</span><br><span class="line">cd /usr/local/src</span><br><span class="line">git clone https://gitee.com/nwaycn/libav.git</span><br><span class="line">cd libav</span><br><span class="line">./configure --enable-pic --enable-shared  --enable-libx264 --enable-gpl --extra-libs=&quot;-ldl&quot;</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">cp /usr/local/lib/pkgconfig/libavcodec.pc    /usr/lib64/pkgconfig/</span><br><span class="line">cp /usr/local/lib/pkgconfig/libavdevice.pc   /usr/lib64/pkgconfig/</span><br><span class="line">cp /usr/local/lib/pkgconfig/libavfilter.pc   /usr/lib64/pkgconfig/</span><br><span class="line">cp /usr/local/lib/pkgconfig/libavformat.pc   /usr/lib64/pkgconfig/</span><br><span class="line">cp /usr/local/lib/pkgconfig/libavresample.pc /usr/lib64/pkgconfig/</span><br><span class="line">cp /usr/local/lib/pkgconfig/libavutil.pc     /usr/lib64/pkgconfig/</span><br><span class="line">cp /usr/local/lib/pkgconfig/libswscale.pc    /usr/lib64/pkgconfig/</span><br><span class="line">ldconfig  #动态链接库管理命令，其目的为了让动态链接库为系统所共享</span><br></pre></td></tr></table></figure>
<h2 id="安装spandsp"><a href="#安装spandsp" class="headerlink" title="安装spandsp"></a>安装spandsp</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/src/freeswitch-1.10.5.-release</span><br><span class="line">git clone https://github.com/freeswitch/spandsp.git</span><br><span class="line">cd spandsp</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">ldconfig</span><br></pre></td></tr></table></figure>
<h2 id="安装sofia-sip"><a href="#安装sofia-sip" class="headerlink" title="安装sofia-sip"></a>安装sofia-sip</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/src/freeswitch-1.10.5.-release</span><br><span class="line">git clone https://github.com/freeswitch/sofia-sip.git</span><br><span class="line">cd sofia-sip</span><br><span class="line">./bootstrap.sh -j</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">ldconfig</span><br></pre></td></tr></table></figure>
<h2 id="设置包路径"><a href="#设置包路径" class="headerlink" title="设置包路径"></a>设置包路径</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig:$&#123;PKG_CONFIG_PATH&#125;</span><br></pre></td></tr></table></figure>
<h2 id="安装编译环境"><a href="#安装编译环境" class="headerlink" title="安装编译环境"></a>安装编译环境</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y http://files.freeswitch.org/freeswitch-release-1-6.noarch.rpm epel-release</span><br></pre></td></tr></table></figure>
<h2 id="编译Freeswitch"><a href="#编译Freeswitch" class="headerlink" title="编译Freeswitch"></a>编译Freeswitch</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/src/</span><br><span class="line">tar vzxf freeswitch-1.10.5.-release.tar.gz</span><br><span class="line">cd freeswitch-1.10.5.-release</span><br><span class="line">./configure --disable-signalwire</span><br><span class="line"># 如果在configure报错，再重新设置下包路径</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h2 id="You-must-install-libopus-dev-to-build-mod-opus-Stop-报错"><a href="#You-must-install-libopus-dev-to-build-mod-opus-Stop-报错" class="headerlink" title="You must install libopus-dev to build mod_opus. Stop.报错"></a><code>You must install libopus-dev to build mod_opus. Stop.</code>报错</h2><p>找到codecs目录，直接删除codec_opus子目录。编译成功</p>
<h2 id="配置freeswitch任何路径启动"><a href="#配置freeswitch任何路径启动" class="headerlink" title="配置freeswitch任何路径启动"></a>配置freeswitch任何路径启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -sf /usr/local/freeswitch/bin/freeswitch /usr/local/bin/</span><br><span class="line">ln -sf /usr/local/freeswitch/bin/fs_cli /usr/local/bin/</span><br></pre></td></tr></table></figure>
<h2 id="freeswitch-后台启动"><a href="#freeswitch-后台启动" class="headerlink" title="freeswitch 后台启动"></a>freeswitch 后台启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 后台启动命令</span><br><span class="line">freeswitch -nc -rp</span><br><span class="line"> </span><br><span class="line"># 进入命令</span><br><span class="line">fs_cli</span><br><span class="line"> </span><br><span class="line"># 退出命令</span><br><span class="line">/exit </span><br><span class="line">/bye </span><br><span class="line">等等...</span><br><span class="line"> </span><br><span class="line"># fs_cli报错</span><br><span class="line">fs_cli.c:1673 main() Error Connecting [] </span><br><span class="line"># 解决方法</span><br><span class="line">vim /usr/local/freeswitch/conf/autoload_configs/event_socket.conf.xml </span><br><span class="line">&lt;param name=&quot;listen-ip&quot; value=&quot;::&quot;/&gt;  改为 &lt;param name=&quot;listen-ip&quot; value=&quot;0.0.0.0&quot;/&gt;</span><br></pre></td></tr></table></figure>
<h2 id="设置fs支持ssl"><a href="#设置fs支持ssl" class="headerlink" title="设置fs支持ssl"></a>设置fs支持ssl</h2><h3 id="宝塔面板设置域名及nginx设置"><a href="#宝塔面板设置域名及nginx设置" class="headerlink" title="宝塔面板设置域名及nginx设置"></a>宝塔面板设置域名及nginx设置</h3><h3 id="设置nginx的ssl"><a href="#设置nginx的ssl" class="headerlink" title="设置nginx的ssl"></a>设置nginx的ssl</h3><h3 id="配置fs"><a href="#配置fs" class="headerlink" title="配置fs"></a>配置fs</h3><ul>
<li><p>打开<code>conf/vars.conf</code> 设置支持ssl的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;X-PRE-PROCESS cmd=&quot;set&quot; data=&quot;internal_ssl_enable=true&quot;/&gt; </span><br><span class="line">&lt;X-PRE-PROCESS cmd=&quot;set&quot; data=&quot;external_auth_calls=true&quot;/&gt;</span><br><span class="line">&lt;X-PRE-PROCESS cmd=&quot;set&quot; data=&quot;external_ssl_enable=true&quot;/&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开<code>conf/sip_profiles/internal.xml</code> 查看ws和wss端口是否已打开</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- for sip over websocket support --&gt;</span><br><span class="line">&lt;param name=&quot;ws-binding&quot;  value=&quot;:5066&quot;/&gt;</span><br><span class="line"> </span><br><span class="line">&lt;!-- for sip over secure websocket support --&gt;</span><br><span class="line">&lt;!-- You need wss.pem in $$&#123;certs_dir&#125; for wss or one will be created for you --&gt;</span><br><span class="line">&lt;param name=&quot;wss-binding&quot; value=&quot;:7443&quot;/&gt;   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 在底部增加：</span><br><span class="line">&lt;param name=&quot;apply-candidate-acl&quot; value=&quot;121.37.189.177&quot;/&gt;</span><br><span class="line">    &lt;param name=&quot;apply-candidate-acl&quot; value=&quot;rfc1918.auto&quot;/&gt;</span><br><span class="line">    &lt;param name=&quot;apply-candidate-acl&quot; value=&quot;localnet.auto&quot;/&gt;</span><br><span class="line">    &lt;param name=&quot;apply-candidate-acl&quot; value=&quot;lan&quot;/&gt;</span><br><span class="line">    &lt;param name=&quot;apply-candidate-acl&quot; value=&quot;wan&quot;/&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>打开<code>conf/autoload_configs/acl_conf.xml</code>并配置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;list name=&quot;localnet.auto&quot; default=&quot;allow&quot;&gt;</span><br><span class="line">&lt;/list&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>配置fs证书为宝塔设置的证书</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/freeswitch/certs</span><br><span class="line"># 备份fs的原有证书</span><br><span class="line">mv wss.pem wss.pem.bak</span><br><span class="line"></span><br><span class="line">touch wss.pem</span><br><span class="line">cat /etc/xxx/live/xxx.com/fullchain.pem &gt; wss.pem</span><br><span class="line">cat /etc/xxx/live/uxxx.com/privkey.pem &gt; wss.pem</span><br></pre></td></tr></table></figure>
<h2 id="配置网关"><a href="#配置网关" class="headerlink" title="配置网关"></a>配置网关</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 新建文件 /usr/local/freeswitch/conf/dialplan/default/00_gw1.xml</span><br><span class="line"></span><br><span class="line">&lt;include&gt;</span><br><span class="line">    &lt;extension name=&quot;call_out3&quot;&gt;</span><br><span class="line">        &lt;condition field=&quot;destination_number&quot; expression=&quot;^10(.*)$&quot;&gt;</span><br><span class="line">            &lt;action application=&quot;set&quot; data=&quot;effective_caller_id_name=200200001&quot;/&gt;</span><br><span class="line">            &lt;action application=&quot;set&quot; data=&quot;effective_caller_id_number=200200001&quot;/&gt;</span><br><span class="line">            &lt;!--&lt;action application=&quot;bridge&quot; data=&quot;sofia/gateway/gw3/$1&quot;/&gt;--&gt;</span><br><span class="line">            &lt;action application=&quot;bridge&quot; data=&quot;sofia/gateway/gw3/cs1$1&quot;/&gt;</span><br><span class="line">        &lt;/condition&gt;</span><br><span class="line">    &lt;/extension&gt;</span><br><span class="line"></span><br><span class="line">&lt;/include&gt;</span><br><span class="line"></span><br><span class="line"># 新建文件 /usr/local/freeswitch/conf/sip_profiles/external/gw1.xml </span><br><span class="line"></span><br><span class="line">&lt;include&gt;</span><br><span class="line">    &lt;gateway name=&quot;gw3&quot;&gt;</span><br><span class="line">    &lt;param name=&quot;realm&quot; value=&quot;121.196.168.81:62019&quot;/&gt;</span><br><span class="line">      &lt;param name=&quot;proxy&quot; value=&quot;121.196.168.81:62019&quot;/&gt;</span><br><span class="line">    &lt;param name=&quot;username&quot; value=&quot;&quot;/&gt;</span><br><span class="line">    &lt;param name=&quot;password&quot; value=&quot;&quot;/&gt;</span><br><span class="line">    &lt;param name=&quot;register&quot; value=&quot;false&quot;/&gt;</span><br><span class="line">    &lt;param name=&quot;caller-id-in-from&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">    &lt;/gateway&gt;</span><br><span class="line">&lt;/include&gt;</span><br></pre></td></tr></table></figure>
<h2 id="重启fs服务"><a href="#重启fs服务" class="headerlink" title="重启fs服务"></a>重启fs服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sofia profile external rescan reloadxml</span><br></pre></td></tr></table></figure>
<h2 id="拨号测试"><a href="#拨号测试" class="headerlink" title="拨号测试"></a>拨号测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">originate &#123;effective_caller_id_numer=200200001&#125;sofia/internal/xxx15180347840@x.x.x.x:5060 &amp;bridge(user/1001)</span><br><span class="line"></span><br><span class="line"># xxx 为呼叫前缀</span><br></pre></td></tr></table></figure>
<p>originate <a href="mailto:{effective_caller_id_numer=846374233}sofia/internal/18757131514@112.74.104.148" target="_blank" rel="noopener">{effective_caller_id_numer=846374233}sofia/internal/18757131514@112.74.104.148</a>:7060 &amp;bridge(user/1000)</p>
<p>originate {auto_answer=true,<a href="mailto:effective_caller_id_numer=846374233}sofia/external/18757131514@112.74.104.148" target="_blank" rel="noopener">effective_caller_id_numer=846374233}sofia/external/18757131514@112.74.104.148</a>:7060 &amp;bridge({instant_ringback=true,<a href="mailto:effective_caller_id_numer=846374233}sofia/external/15058371889@112.74.104.148" target="_blank" rel="noopener">effective_caller_id_numer=846374233}sofia/external/15058371889@112.74.104.148</a>:7060)</p>
<h2 id="查看已注册的坐席"><a href="#查看已注册的坐席" class="headerlink" title="查看已注册的坐席"></a>查看已注册的坐席</h2><p>bgapi originate {ringback=/usr/local/freeswitch/sounds/229.wav,ignore_early_media=true,effective_caller_id_numer=846374233}sofia/gateway/gw2/18757131514 ‘&amp;lua(call.lua 360 15058371889 846374233)</p>
<p>平安车险 小蒋<br>4558.00<br>200万+座位险41万/坐</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2021/05/30/freeswitch在centos中安装/" data-id="cm50h3rbm007oyfhtx63ihtq5" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2021/05/30/freeswitch在centos中安装/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/freeswitch/">freeswitch</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mysql查询近7天，半年，一年数据" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/02/19/mysql查询近7天，半年，一年数据/" class="article-date">
  <time datetime="2021-02-19T02:41:01.000Z" itemprop="datePublished">2021-02-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/mysql/">mysql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/19/mysql查询近7天，半年，一年数据/">mysql查询近7天，半年，一年数据</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>近7天数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * from oms_order_item_comment </span><br><span class="line">     where comment_time between date_sub(now(),interval 1 week) and now()  -- 七天</span><br></pre></td></tr></table></figure>
<ul>
<li>半年数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * from oms_order_item_comment </span><br><span class="line">     where comment_time between date_sub(now(),interval 6 month) and now()  -- 半年</span><br></pre></td></tr></table></figure>
<ul>
<li>一年数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * from oms_order_item_comment </span><br><span class="line">     where comment_time between date_sub(now(),interval 1 year) and now()  -- 一年</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2021/02/19/mysql查询近7天，半年，一年数据/" data-id="cm50h3rbe007cyfhtuoto66le" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2021/02/19/mysql查询近7天，半年，一年数据/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Django-ContentTypes使用示例" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/02/19/Django-ContentTypes使用示例/" class="article-date">
  <time datetime="2021-02-19T02:22:46.000Z" itemprop="datePublished">2021-02-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/django/">django</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/19/Django-ContentTypes使用示例/">Django.ContentTypes使用示例</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>转载于<a href="https://blog.csdn.net/qq_29113041/article/details/87285265?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control" target="_blank" rel="noopener">这里</a></p>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>Django创建项目后，在settings.py中默认加载了以下几个app：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    &apos;django.contrib.admin&apos;,</span><br><span class="line">    &apos;django.contrib.auth&apos;,</span><br><span class="line">    &apos;django.contrib.contenttypes&apos;,</span><br><span class="line">    &apos;django.contrib.sessions&apos;,</span><br><span class="line">    &apos;django.contrib.messages&apos;,</span><br><span class="line">    &apos;django.contrib.staticfiles&apos;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>其中有个app为<code>django.contrib.contenttypes</code>，在使用了<code>python manage.py makemigrations</code> 和 <code>python manage.py migrate</code>命令后，这个app会在数据库创建表 <code>django_content_type</code></p>
<p><code>django_content_type</code>表存储了用户所提交的所有model名称与model所在的app名称</p>
<p>其中的<code>model</code>字段为用户定义的模型类的名称，<code>app_label</code>为该模型所在app名称</p>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>使用的例子，现在有四个model，我们自己创建的Post，Picture和Comment，加上django原生的User。</p>
<ul>
<li><p>django原生的User model即用户表</p>
</li>
<li><p>Comment为用户提交的评论表</p>
</li>
<li><p>Picture为存储图片信息的表</p>
</li>
<li><p>Post为存储文章信息的表</p>
</li>
</ul>
<p>场景如下：用户可以对图片或者文章提交评论，那么Comment中首先要存储的是，该评论对应的用户，再就是该评论是针对哪张图片或者哪篇文章的评论，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line">from django.contrib.auth.models import User</span><br><span class="line">class Post(models.Model):</span><br><span class="line">    author = models.ForeignKey(User, on_delete=models.CASCADE)</span><br><span class="line">    body = models.TextField(blank=True)</span><br><span class="line">class Picture(models.Model):</span><br><span class="line">    author = models.ForeignKey(User, on_delete=models.CASCADE)</span><br><span class="line">    body = models.TextField(blank=True)</span><br><span class="line">class Comment(models.Model):</span><br><span class="line">    author = models.ForeignKey(to=User, on_delete=models.CASCADE)</span><br><span class="line">    body = models.TextField(blank=True)</span><br><span class="line">    pic = models.ForeignKey(to=Picture, on_delete=models.CASCADE, null=True)</span><br><span class="line">    post = models.ForeignKey(to=Post, on_delete=models.CASCADE, null=True)</span><br></pre></td></tr></table></figure>
<p>为了建立Comment与Post或者Picture的关系，我们就需要创建外键，如果该Comment与Picture有关联，那么pic字段是有值的，而其余的关联字段为null。这样实现的缺点是，每增加一种被评论的类型，在Comment model中就需要多新增一个外键，扩展性极差。</p>
<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><p>如果使用contenttypes就不需要再使用多个Foreignkey，因为在<code>django_content_type</code>表已经存储了app名和model名，所以我们只需要将我们创建的模型与<code>django_content_type</code>表关联起来，然后再存储一个实例 id 即可准确定位到某个app中某个模型的具体实例。代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line">from django.contrib.contenttypes.models import ContentType</span><br><span class="line">from django.contrib.auth.models import User</span><br><span class="line">from django.contrib.contenttypes.fields import GenericForeignKey, GenericRelation</span><br><span class="line">class Post(models.Model):</span><br><span class="line">    author = models.ForeignKey(User, on_delete=models.CASCADE)</span><br><span class="line">    body = models.TextField(blank=True)</span><br><span class="line">    comments = GenericRelation(&apos;Comment&apos;)  # 使用GenericRelation可以建立该类与Comment类的反向关联，</span><br><span class="line">                                           # 那么可以通过该类的实例来创建对应的comment</span><br><span class="line">class Picture(models.Model):</span><br><span class="line">    author = models.ForeignKey(User, on_delete=models.CASCADE)</span><br><span class="line">    body = models.TextField(blank=True)</span><br><span class="line">    comments = GenericRelation(&apos;Comment&apos;)</span><br><span class="line">class Comment(models.Model):</span><br><span class="line">    #  user_name = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)</span><br><span class="line">    author = models.ForeignKey(to=User, on_delete=models.CASCADE)</span><br><span class="line">    body = models.TextField(blank=True)</span><br><span class="line">    # step1</span><br><span class="line">    # ForeignKey为外键，即在Comment类中，content_type对应了django_content_type表中的某个对象</span><br><span class="line">    content_type = models.ForeignKey(to=ContentType, on_delete=models.CASCADE)  # 与数据库中的django_content_type表关联起来</span><br><span class="line">    # step2</span><br><span class="line">    object_id = models.PositiveIntegerField()  # 正整数类型，在被关联的表中的实例id，以此来定位具体的实例</span><br><span class="line">    # step3</span><br><span class="line">    content_object = GenericForeignKey()  # 根据content_type和object_id来指向一个模型中的具体实例</span><br></pre></td></tr></table></figure>
<p>首先看Comment这个模型，与contenttypes相关的就三个字段：<code>content_tpye</code>   <code>object_id</code>    <code>content_object</code></p>
<p><code>content_type</code>字段为外键，指向ContentType这个模型，也就是上面提到的<code>django_content_type</code>表</p>
<p><code>object_id</code>为一个整数，存储了实例id，实例id不理解可以看下面的数据表结构分析</p>
<p><code>content_object</code>为<code>GenericForeignKey</code>类型，主要作用是根据<code>content_type</code>字段和<code>object_id</code>字段来定位某个模型中具体某个实例</p>
<p>所以实际上在使用<code>GenericForeignKey()</code>函数时需要传入两个参数，即<code>content_type</code>和<code>object_id</code>字段的名字，注意是名字不是value。但是默认在该函数的构造函数中已经赋予了默认值，即<code>content_type</code>和<code>object_id</code>，所以如果我们定义的变量名为这两个，那么我们可以省略该参数。该字段不会存储到数据库中，在查询的时候ORM会用到。</p>
<p>GenericForeignKey构造函数如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def __init__(self, ct_field=&apos;content_type&apos;, fk_field=&apos;object_id&apos;, for_concrete_model=True):</span><br><span class="line">    self.ct_field = ct_field</span><br><span class="line">    self.fk_field = fk_field</span><br><span class="line">    self.for_concrete_model = for_concrete_model</span><br><span class="line">    self.editable = False</span><br><span class="line">    self.rel = None</span><br><span class="line">    self.column = None</span><br></pre></td></tr></table></figure>
<p>将模型同步到数据库，并创建几个测试数据，使用manage.py自带的shell可以轻松的创建测试数据。</p>
<p><code>python manage.py shell</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from app1.models import Post, Picture, Comment  # app1即为你自己所创建的app名</span><br><span class="line">from django.contrib.auth.models import User  # django原生用户模型</span><br><span class="line">user = User.objects.get(username=&apos;admin-x&apos;)</span><br><span class="line">post = Post.objects.create(author=user, body=&apos;admin-x post test&apos;)</span><br><span class="line">picture = Picture.objects.create(author=user, body=&apos;admin-x pic test&apos;)</span><br><span class="line"> </span><br><span class="line">pic = Picture.objects.get(id=1) # 获取id为1的pic对象</span><br><span class="line">c1 = Comment.objects.create(author=user, body=&apos;test&apos;, content_object=pic) # 创建一个评论并与上述的pic对象关联起来</span><br></pre></td></tr></table></figure>
<p>还可以注意到，在Post和Picture模型中我们定义了<code>comments = GenericRelation(&#39;Comment&#39;)</code></p>
<p>GenericRelation的作用是建立该model与Comment的反向关联，我们这样就可以通过Post实例或者Picture实例直接查询属于该实例的所有评论，或者创建一个属于该实例的新评论。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pic = Picture.objects.get(id=1) # 获取id为1的pic对象</span><br><span class="line">pic.comments.create(author=user, body=&apos;test02&apos;)  # 创建一个属于pic对象的评论</span><br><span class="line">pic.comments.all()  # 获取属于pic对象的所有评论</span><br></pre></td></tr></table></figure>
<p>实际上在数据表中，根据<code>content_type_id</code>就可以在<code>django_content_type</code>这个表中定位到哪个app的哪个model，然后根据<code>object_id</code>定位到该model中具体实例。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2021/02/19/Django-ContentTypes使用示例/" data-id="cm50h3rbh007gyfht1hgyms47" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2021/02/19/Django-ContentTypes使用示例/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/django/">django</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Django-queryset实现按指定字段的值进行排序" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/02/04/Django-queryset实现按指定字段的值进行排序/" class="article-date">
  <time datetime="2021-02-04T06:46:12.000Z" itemprop="datePublished">2021-02-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/django/">django</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/04/Django-queryset实现按指定字段的值进行排序/">[Django]queryset实现按指定字段的值进行排序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>文章转载于<a href="https://zgljl2012.com/django-querysetshi-xian-an-zhi-ding-zi-duan-de-zhi-jin-xing-pai-xu/" target="_blank" rel="noopener">这里</a></p>
<p>最近碰到一个需求，要对用户的学历进行排序，也就是按照[‘中专及以下’, ‘高中’, ‘大专’, ‘本科’, ‘硕士’, ‘博士’]的顺序进行排序，这就需要使用Django的ORM实现按指定字段的值进行排序。</p>
<ol>
<li>MySQL中的SQL语句的语法：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user_education where user_id = 1 ORDER BY FIELD(degree, &apos;中专及以下&apos;, &apos;高中&apos;, &apos;大专&apos;, &apos;本科&apos;, &apos;硕士&apos;, &apos;博士&apos;) DESC</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>python代码</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ordering = &apos;FIELD(`degree`, &#123;&#125;)&apos;.format(&apos;,&apos;.join([ &quot;&apos;&#123;&#125;&apos;&quot;.format(i) for i in educations]))</span><br><span class="line">education_last = Education.objects.filter(user_id=user[&apos;id&apos;]).\</span><br><span class="line">								   extra(select=&#123;&apos;ordering&apos;: ordering&#125;, order_by=(&apos;-ordering&apos;,))</span><br></pre></td></tr></table></figure>
<p>可通过数据库日志看到生成的sql语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT (FIELD(`degree`, &apos;中专及以下&apos;,&apos;高中&apos;,&apos;大专&apos;,&apos;本科&apos;,&apos;硕士&apos;,&apos;博士&apos;)) AS `ordering` FROM `user_education` WHERE `user_education`.`user_id` = 31 ORDER BY `ordering` DESC LIMIT 1</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2021/02/04/Django-queryset实现按指定字段的值进行排序/" data-id="cm50h3rbc0079yfhty9uv4oyk" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2021/02/04/Django-queryset实现按指定字段的值进行排序/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/django/">django</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/5/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Github/">Github</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Karrigell/">Karrigell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/VIM/">VIM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/conda/">conda</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/django/">django</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ffmpeg/">ffmpeg</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/freeswitch/">freeswitch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/go/">go</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jekyll/">jekyll</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kivy/">kivy</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/mac/">mac</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/normal/">normal</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/sqlalchemy/">sqlalchemy</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system/">system</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tornado/">tornado</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ubuntu/">ubuntu</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/conda/">conda</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django-celery/">django-celery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ffmpeg/">ffmpeg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/">flask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/freeswitch/">freeswitch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/">mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/other/">other</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlalchemy/">sqlalchemy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/system/">system</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tornado/">tornado</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/">ubuntu</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/conda/" style="font-size: 10px;">conda</a> <a href="/tags/django/" style="font-size: 18px;">django</a> <a href="/tags/django-celery/" style="font-size: 10px;">django-celery</a> <a href="/tags/ffmpeg/" style="font-size: 10px;">ffmpeg</a> <a href="/tags/flask/" style="font-size: 10px;">flask</a> <a href="/tags/freeswitch/" style="font-size: 10px;">freeswitch</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/go/" style="font-size: 14px;">go</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/linux/" style="font-size: 16px;">linux</a> <a href="/tags/mac/" style="font-size: 10px;">mac</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/other/" style="font-size: 12px;">other</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/sqlalchemy/" style="font-size: 10px;">sqlalchemy</a> <a href="/tags/system/" style="font-size: 12px;">system</a> <a href="/tags/tornado/" style="font-size: 10px;">tornado</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">December 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">June 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">September 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/12/23/Python-Typing类型提示/">Python Typing类型提示</a>
          </li>
        
          <li>
            <a href="/2024/12/23/Python-Tempfile临时文件系统对象/">Python Tempfile临时文件系统对象</a>
          </li>
        
          <li>
            <a href="/2024/12/23/Python-Pathlib处理文件路径库的使用/">Python Pathlib处理文件路径库的使用</a>
          </li>
        
          <li>
            <a href="/2024/08/31/在ubuntu上的18个非常实用的命令行工具软件/">在ubuntu上的18个非常实用的命令行工具软件</a>
          </li>
        
          <li>
            <a href="/2024/08/20/什么是动态规划？在Python中如何利用动态规划解决实际问题？/">什么是动态规划？在Python中如何利用动态规划解决实际问题？</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2024 Tony Tan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'TonyTan';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>