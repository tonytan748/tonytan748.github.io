<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Tony Tan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Tony Tan">
<meta name="keywords" content="Tony Tan">
<meta property="og:type" content="website">
<meta property="og:title" content="Tony Tan">
<meta property="og:url" content="https://tonytan748.github.io/page/8/index.html">
<meta property="og:site_name" content="Tony Tan">
<meta property="og:description" content="Tony Tan">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Tony Tan">
<meta name="twitter:description" content="Tony Tan">
  
    <link rel="alternate" href="/atom.xml" title="Tony Tan" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Tony Tan</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">a python progrmmer</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://tonytan748.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-set-up-data-in-custom-django-context-processors-to-access-on-all-django-templates" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/01/set-up-data-in-custom-django-context-processors-to-access-on-all-django-templates/" class="article-date">
  <time datetime="2016-07-31T16:00:00.000Z" itemprop="datePublished">2016-08-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/django/">django</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/01/set-up-data-in-custom-django-context-processors-to-access-on-all-django-templates/">Set up data in custom Django context processors to access on all Django templates</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h1><p>You want to set up data to become available on all Django templates, without having to set up the data individually on Django view methods.</p>
<h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>Create a custom Django context processor method. Add the custom Django context processor method to the <code>context_processors</code> variable in <code>OPTIONS</code> of the TEMPLATES variable of a project’s <code>settings.py</code> file. Use standard Django template syntax to gain access to the data exposed by the custom Django context processor method.</p>
<h1 id="How-it-works"><a href="#How-it-works" class="headerlink" title="How it works"></a>How it works</h1><p>Unlike data set up in Django view methods or url extra options where data is only available on individual Django templates, custom Django context processor methods allow you to set up data for access on all Django project templates.</p>
<p>A custom Django context processor method is just like a regular Python method with an HttpRequest object argument that returns a dictionary. Where the returning dictionary keys represent template references and the values data objects (e.g. strings, lists, dictionaries) to be exposed on the template. Listing 1 illustrates a custom Django context processor method.</p>
<p>Listing 1 - Custom Django context processor method</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">onsale</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># Create fixed data structures to pass to template</span></span><br><span class="line">    <span class="comment"># data could equally come from database queries</span></span><br><span class="line">    <span class="comment"># web services or social APIs</span></span><br><span class="line">    sale_items = &#123;<span class="string">'Monday'</span>:<span class="string">'Mocha 2x1'</span>,<span class="string">'Tuesday'</span>:<span class="string">'Latte 2x1'</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'SALE_ITEMS'</span>: sale_items&#125;</span><br></pre></td></tr></table></figure>
<p>As you can see in listing 1, the <code>onsale</code> method in listing 1 has a <code>request</code> argument – which is the HttpRequest object – and returns a dictionary. The dictionary in this case has a single key called <code>SALE_ITEMS</code> and a value which is a hard-coded dictionary. However, just as you could set up any type of data from a Django view method to pass to a template, a custom Django context processor method can also access any data you wish to be made available to a template.</p>
<p>The custom context processor method can be placed inside any project file or directory. The location and naming conventions are of little importance, because Django detects context processors through the <code>context_processors</code> variable in <code>OPTIONS</code> of the <code>TEMPLATES</code> variable of a project’s <code>settings.py</code> file. To keep things organized I’ll place the method in listing 1 inside a file called <code>processors.py</code> in the <code>stores</code> app sub-directory.</p>
<p>Once you save the custom context processor method, you have to configure Django to locate it. Listing 2 shows the <code>context_processors</code> variable to activate the custom context processor method.</p>
<p>Listing 2 - Django template context processor definitions in <code>context_processors</code> in OPTIONS of TEMPLATES</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'OPTIONS'</span>: &#123;</span><br><span class="line">            <span class="string">'context_processors'</span>: [</span><br><span class="line">                <span class="string">'coffeehouse.stores.processors.onsale'</span>,</span><br><span class="line">                <span class="string">'django.template.context_processors.debug'</span>,</span><br><span class="line">                <span class="string">'django.template.context_processors.request'</span>,</span><br><span class="line">                <span class="string">'django.contrib.auth.context_processors.auth'</span>,</span><br><span class="line">                <span class="string">'django.contrib.messages.context_processors.messages'</span>,</span><br><span class="line">            ],</span><br><span class="line">	 &#125;</span><br></pre></td></tr></table></figure>
<p>In listing 2 you can see the <code>coffeehouse.stores.processors.onsale</code> declaration in the <code>context_processors</code> list. The first part <code>coffeehouse.stores</code> represents the package.app name, <code>processors</code> is the file that contains the custom context processor (i.e. <code>processors.py</code> inside the <code>stores</code> app) and <code>onsale</code> is the actual method that contains the custom context processor logic.</p>
<p>The remaining values specified in the <code>context_processors</code> list are Django’s default context processors. These last context processors expose general purpose application data to all templates.</p>
<p>Once you declare the <code>context_processors</code> illustrated in listing 2 on you project’s <code>settings.py</code> file, the custom dictionary with the SALE_ITEMS key in listing 1 becomes available to all Django templates.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2016/08/01/set-up-data-in-custom-django-context-processors-to-access-on-all-django-templates/" data-id="cm50h3r9v004myfht7gedd1aw" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2016/08/01/set-up-data-in-custom-django-context-processors-to-access-on-all-django-templates/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-curl-command-reference" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/03/curl-command-reference/" class="article-date">
  <time datetime="2016-07-02T16:00:00.000Z" itemprop="datePublished">2016-07-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/03/curl-command-reference/">CURL command reference</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <table>
<thead>
<tr>
<th>Operations</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>-X</td>
<td>appoint HTTP request method, like POST, GET</td>
</tr>
<tr>
<td>-H</td>
<td>appoint request header, for example Content-type:application/json</td>
</tr>
<tr>
<td>-d</td>
<td>appoint request data</td>
</tr>
<tr>
<td>–data-binary</td>
<td>appoint send files</td>
</tr>
<tr>
<td>-i</td>
<td>show response header info</td>
</tr>
<tr>
<td>-u</td>
<td>appoint authentication username and password</td>
</tr>
<tr>
<td>-v</td>
<td>point request header info</td>
</tr>
</tbody>
</table>
<p>For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X PATCH http://127.0.0.1:5000/echo  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result:</span><br><span class="line">GET /echo</span><br><span class="line">ECHO: GET</span><br><span class="line"> </span><br><span class="line">POST /ECHO</span><br><span class="line">ECHO: POST</span><br></pre></td></tr></table></figure>
<pre><code>curl -H &quot;Content-type: application/json&quot; \
-X POST http://127.0.0.1:5000/messages -d &apos;{&quot;message&quot;:&quot;Hello Data&quot;}&apos;  

result:
POST /messages {&quot;message&quot;: &quot;Hello Data&quot;}
Content-type: application/json
JSON Message: {&quot;message&quot;: &quot;Hello Data&quot;}

POST /message &lt;message.bin&gt;
Content-type: application/octet-stream
Binary message written!


curl -i http://127.0.0.1:5000/hello  

result:
GET /hello
HTTP/1.0 200 OK
Content-Type: application/json
Content-Length: 31
Link: http://luisrei.com
Server: Werkzeug/0.8.2 Python/2.7.1
Date: Wed, 25 Apr 2012 16:40:27 GMT
{&quot;hello&quot;: &quot;world&quot;, &quot;number&quot;: 3}


curl -v -u &quot;admin:secret&quot; http://127.0.0.1:5000/secrets

# result:
GET /secrets Authorization: Basic YWRtaW46c2VjcmV0
Shhh this is top secret spy stuff!

</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2016/07/03/curl-command-reference/" data-id="cm50h3r9s004gyfhtx1pt7lh3" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2016/07/03/curl-command-reference/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-prtfect-single-code-for-python" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/26/prtfect-single-code-for-python/" class="article-date">
  <time datetime="2016-06-25T16:00:00.000Z" itemprop="datePublished">2016-06-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/26/prtfect-single-code-for-python/">Prtfect Single Code for Python</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>some coding for python which one line to finish a common</em></p>
<ul>
<li>Product 2 for every element in list</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print map(lambda x:x*2, range(1,11))</span><br></pre></td></tr></table></figure>
<ul>
<li>Sum of all elements in list</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print sum(range(1,1001))</span><br></pre></td></tr></table></figure>
<ul>
<li>Check if there are some world in a string</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wordlist = [&quot;scala&quot;, &quot;akka&quot;, &quot;play framework&quot;, &quot;sbt&quot;, &quot;typesafe&quot;]</span><br><span class="line">tweet = &quot;This is an example tweet talking about scala and sbt.&quot;</span><br><span class="line"></span><br><span class="line">print map(lambda x: x in tweet.split(), wordlist)</span><br></pre></td></tr></table></figure>
<ul>
<li>Read file</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print open(&apos;ten_one_lines.py&apos;).readlines()</span><br></pre></td></tr></table></figure>
<ul>
<li>Happy Birthday</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print map(lambda x: &quot;Happy Birthday to &quot; + (&quot;you&quot; if x!=2 else &quot;dear Name&quot;), range(4))</span><br></pre></td></tr></table></figure>
<ul>
<li>Filter nums in list</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print reduce(lambda (a,b),c: (a+[c],b) if c &gt; 60 else (a,b+[c]), [49, 58, 76, 82, 88. 90], ([], []))</span><br></pre></td></tr></table></figure>
<ul>
<li>Obtin XML web service data and analysis</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from xml.dom.minidom import parse, parseString</span><br><span class="line">import urllib2</span><br><span class="line"></span><br><span class="line">print parse(urllib2.urlopen(&apos;http://search.twitter.com/..&apos;)).toprettyxml(encoding=&quot;utf-8&quot;)</span><br></pre></td></tr></table></figure>
<ul>
<li>Find the max and min data in list</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print min([14,35,-1,46,38])</span><br><span class="line">print max([14,35,-1,46,38])</span><br></pre></td></tr></table></figure>
<ul>
<li>Milti processing</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import multiprocessing</span><br><span class="line">import math</span><br><span class="line"></span><br><span class="line">print list(mulriprocessing.Pool(pricesses=4).map(math.exp, range(1, 11)))</span><br></pre></td></tr></table></figure>
<ul>
<li>“Sieve of Eratosthenes” algorithm</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">n = 50</span><br><span class="line">print sorted(set(range(2, n+1)).difference(set((p * f) for p in range(2, int(n**0.5) + 2) for f in range(2, (n/p)+1))))</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2016/06/26/prtfect-single-code-for-python/" data-id="cm50h3r9t004iyfht5h3s1x9g" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2016/06/26/prtfect-single-code-for-python/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-nifty-python-tricks" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/21/nifty-python-tricks/" class="article-date">
  <time datetime="2016-06-20T16:00:00.000Z" itemprop="datePublished">2016-06-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/21/nifty-python-tricks/">Nifty Python Tricks</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>Some Python Useful Ways</em></p>
<p>This Blog tracsfer from (here)[<a href="https://pythontips.com/2015/04/19/nifty-python-tricks/]" target="_blank" rel="noopener">https://pythontips.com/2015/04/19/nifty-python-tricks/]</a></p>
<h3 id="Enumerate"><a href="#Enumerate" class="headerlink" title="Enumerate"></a>Enumerate</h3><p>Instead of doing:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">i = 0</span><br><span class="line">for item in iterable:</span><br><span class="line">    print i, item</span><br><span class="line">    i += 1</span><br></pre></td></tr></table></figure>
<p>We can do:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for i, item in enumerate(iterable):</span><br><span class="line">    print i, item</span><br></pre></td></tr></table></figure>
<p>Enumerate can also take a second argument, Here is an example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; list(enumerate(&apos;abc&apos;))</span><br><span class="line">[(0,&apos;a&apos;),(1,&apos;b&apos;),(2,&apos;c&apos;)]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; list(enumerate(&apos;abc&apos;, 1))</span><br><span class="line">[(1,&apos;a&apos;),(2,&apos;b&apos;),(3,&apos;c&apos;)]</span><br></pre></td></tr></table></figure>
<h3 id="Dict-Set-comprehensions"><a href="#Dict-Set-comprehensions" class="headerlink" title="Dict/Set comprehensions"></a>Dict/Set comprehensions</h3><p>You might know about list comprehensions but you might not be aware of dict/set comprehensions. They are simple to use and just as effective. Here is an example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">my_dict = &#123;i: i * i for i in xrange(100)&#125;</span><br><span class="line">my_set = &#123;i * 15 for i in xrange(100)&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Forcing-float-divsion"><a href="#Forcing-float-divsion" class="headerlink" title="Forcing float divsion:"></a>Forcing float divsion:</h3><p>If we divide whole numbers Python gives us the result as a whole number even if the result was a float. In order to circumvent this issue we have to do something like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result  = 1.0 / 2</span><br></pre></td></tr></table></figure>
<p>But there is another way to solve this problem which even I wasn’t aware of. You can do:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from __futhure__ import division</span><br><span class="line"></span><br><span class="line">result = 1/2</span><br></pre></td></tr></table></figure>
<p>Now you don’t need to append .0 in order to get an accurate answer.</p>
<p>Do note that this trick is for Pyhton 2 only, In Python 3 there is no need to do the import as it handles this case by default.</p>
<h3 id="Simple-Server"><a href="#Simple-Server" class="headerlink" title="Simple Server"></a>Simple Server</h3><p>Do you want to quickly and easily share files from a directory? You can simple do:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># python 2</span><br><span class="line">python -m SimpleHTTPServer localhost:8080</span><br><span class="line"></span><br><span class="line"># python 3</span><br><span class="line">python3 -m http.server localhost:8080</span><br></pre></td></tr></table></figure>
<p>This would start up a server.</p>
<h3 id="Evaluating-Python-expressions"><a href="#Evaluating-Python-expressions" class="headerlink" title="Evaluating Python expressions"></a>Evaluating Python expressions</h3><p>We all know about <code>eval</code> but do we all know about <code>literal_eval</code>? Perhaps not. You can do:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import ast</span><br><span class="line"></span><br><span class="line">my_list = ast.literal_eval(expr)</span><br></pre></td></tr></table></figure>
<p>Instead of:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expr = &quot;[1,2,3]&quot;</span><br><span class="line">my_list = eval(expr)</span><br></pre></td></tr></table></figure>
<p>I am sure that it’s something new for most of us but it has been a part of Python for a long time.</p>
<h3 id="Profiling-a-script"><a href="#Profiling-a-script" class="headerlink" title="Profiling a script"></a>Profiling a script</h3><p>You can easily profile a script by runnung it like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m cProfile my_script.py</span><br></pre></td></tr></table></figure>
<h3 id="Object-introspection"><a href="#Object-introspection" class="headerlink" title="Object introspection"></a>Object introspection</h3><p>You can inspect objects in Python by using <code>dir()</code>. Here is a simple example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; foo = [1,2,3,4]</span><br><span class="line">&gt;&gt;&gt; dir(foo)</span><br><span class="line">[&apos;__add__&apos;, &apos;__class__&apos;, &apos;__contains__&apos;, </span><br><span class="line">&apos;__delattr__&apos;, &apos;__delitem__&apos;, &apos;__delslice__&apos;, ... , </span><br><span class="line">&apos;extend&apos;, &apos;index&apos;, &apos;insert&apos;, &apos;pop&apos;, &apos;remove&apos;, </span><br><span class="line">&apos;reverse&apos;, &apos;sort&apos;]</span><br></pre></td></tr></table></figure>
<h3 id="Debugging-script"><a href="#Debugging-script" class="headerlink" title="Debugging script"></a>Debugging script</h3><p>You can easily set breakpoints in your script using the <code>pdb</code> module. Here is an example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import pdb</span><br><span class="line"></span><br><span class="line">pdb.set_trace()</span><br></pre></td></tr></table></figure>
<p>You can write <code>pdb.set_trace()</code> anywhere in your script and it will set a breakpoint there. Super convenient. You should also read more about pdb as it has a couple of other hidden gems as welll.</p>
<h3 id="Simplify-if-constructs"><a href="#Simplify-if-constructs" class="headerlink" title="Simplify if constructs"></a>Simplify if constructs</h3><p>If you have to check for serveral values you can easily do:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if n in [1,2,3,4]:</span><br></pre></td></tr></table></figure>
<p>instead of:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if n == 1 or n == 2 or n == 3:</span><br></pre></td></tr></table></figure>
<h3 id="Reversing-a-list-string"><a href="#Reversing-a-list-string" class="headerlink" title="Reversing a list/string"></a>Reversing a list/string</h3><p>You can quickly reverse a list by using:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = [1,2,3,4]</span><br><span class="line">&gt;&gt;&gt; a[::-1]</span><br><span class="line">[4,3,2,1]</span><br><span class="line"></span><br><span class="line">a.reverse()</span><br></pre></td></tr></table></figure>
<p>and the same can be applied to a string as well:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; foo = &apos;abcd&apos;</span><br><span class="line">&gt;&gt;&gt; foo[::-1]</span><br><span class="line">&apos;dcba&apos;</span><br></pre></td></tr></table></figure>
<h3 id="Pretty-print"><a href="#Pretty-print" class="headerlink" title="Pretty print"></a>Pretty print</h3><p>You can print dicts and lists in a beautiful way by doing:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">form pprint import pprint</span><br><span class="line">pprint(my_dict)</span><br></pre></td></tr></table></figure>
<p>This is more effective on dicts. Moreover, if you want to pretty print json quickly from a file then you can simple do:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat file.json | python -m json.tools</span><br></pre></td></tr></table></figure>
<h3 id="Ternary-Operators"><a href="#Ternary-Operators" class="headerlink" title="Ternary Operators"></a>Ternary Operators</h3><p>Ternary operators are shortcut for an if-else statement, and are also known as a conditional operators. Here are some example whick you can use to make your code compact and more beautiful.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[on_true] if [expression] else [on_false]</span><br><span class="line">x, y = 50, 25</span><br><span class="line">samle = x if s &lt; y else y</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2016/06/21/nifty-python-tricks/" data-id="cm50h3r9r004eyfhted04e694" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2016/06/21/nifty-python-tricks/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-python-module-fileinput" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/01/python-module-fileinput/" class="article-date">
  <time datetime="2016-05-31T16:00:00.000Z" itemprop="datePublished">2016-06-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/01/python-module-fileinput/">Python module: fileinput</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>Loop many files in a folder and read them by line</em></p>
<p>I just make a example to explane how to use fileinput.</p>
<p><code>fileinput</code> is use to loop some format files in  a folder, and read it by lines.</p>
<p>The other ways also can to do this task. but fileinput is better. the old wany is use glob get all files then use <code>open(filename)</code> read it , then read it one by one line. or use <code>os.walk</code> to do it.</p>
<p>BUt <code>fileinput</code> is very sample to finish this task.</p>
<p>The example is following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import fileinput</span><br><span class="line">from glob import glob</span><br><span class="line"></span><br><span class="line">for line in fileinput.input(glob(r&apos;d:/*.txt&apos;)):</span><br><span class="line">    print &quot;&#123;&#125; filename: &#123;&#125; lineno: &#123;&#125; linelength: &#123;&#125;&quot;.format(fileinput.lineno(),fileinput.filename(),fileinput.filelineno(),line.strip(&apos;/n&apos;))</span><br><span class="line"></span><br><span class="line">fileinput.close()</span><br></pre></td></tr></table></figure>
<p>Note: afrer finished the read files. it must use <code>fileinput.close()</code> to close this internal object.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2016/06/01/python-module-fileinput/" data-id="cm50h3r9p004ayfhtmwb5ovbk" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2016/06/01/python-module-fileinput/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-install-kernel46-in-ubuntu-1504" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/21/install-kernel46-in-ubuntu-1504/" class="article-date">
  <time datetime="2016-05-20T16:00:00.000Z" itemprop="datePublished">2016-05-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/21/install-kernel46-in-ubuntu-1504/">Install Kernel4.6 in Ubuntu 15.04</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>How to upgrade Ubuntu Kernel to 4.6</em></p>
<p>This blog transfer from <a href="http://www.ostechnix.com/install-linux-kernel-4-6-centos-7-ubuntu-16-04/" target="_blank" rel="noopener">here</a></p>
<p>Check the current Linux kernel version with command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure>
<p>Now, we will install <strong>Linux Kernel 4.6</strong>. You can download the latest kernel from the following link.</p>
<p><a href="http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.6-yakkety/" target="_blank" rel="noopener">Download Linux Kernel 4.6</a></p>
<p>For 64 bit Ubuntu systems:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.6-yakkety/linux-headers-4.6.0-040600_4.6.0-040600.201605151930_all.deb</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.6-yakkety/linux-headers-4.6.0-040600-generic_4.6.0-040600.201605151930_amd64.deb</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.6-yakkety/linux-image-4.6.0-040600-generic_4.6.0-040600.201605151930_amd64.deb</span><br></pre></td></tr></table></figure>
<p>For 32 bit Ubuntu systems:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.6-yakkety/linux-headers-4.6.0-040600_4.6.0-040600.201605151930_all.deb</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.6-yakkety/linux-headers-4.6.0-040600-generic_4.6.0-040600.201605151930_i386.deb</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.6-yakkety/linux-image-4.6.0-040600-generic_4.6.0-040600.201605151930_i386.deb</span><br></pre></td></tr></table></figure>
<p>Then install Kernel 4.6 using command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i *.deb</span><br></pre></td></tr></table></figure>
<p>Finally, update the Grub boot loader with command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-grub</span><br></pre></td></tr></table></figure>
<p>If you’re using BURG boot loader,then run:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-burg</span><br></pre></td></tr></table></figure>
<p>Reboot your system and log in to the newly installed Kernel.</p>
<p>Check if new Kernel has been installed with command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unmae -r</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2016/05/21/install-kernel46-in-ubuntu-1504/" data-id="cm50h3r9q004cyfhtpdsnb6da" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2016/05/21/install-kernel46-in-ubuntu-1504/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-a-few-things-to-remember-while-coding-in-python" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/14/a-few-things-to-remember-while-coding-in-python/" class="article-date">
  <time datetime="2016-05-13T16:00:00.000Z" itemprop="datePublished">2016-05-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/14/a-few-things-to-remember-while-coding-in-python/">A Few Things To Remember While Coding In Python</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Transfer from <a href="http://satyajit.ranjeev.in/2012/05/17/python-a-few-things-to-remember.html" target="_blank" rel="noopener">http://satyajit.ranjeev.in/2012/05/17/python-a-few-things-to-remember.html</a></p>
<h3 id="Zen-of-Python"><a href="#Zen-of-Python" class="headerlink" title="Zen of Python"></a>Zen of Python</h3><p>Learing the culture that surrounds a language bringd you one step closer to being a better programmer. If you haven’t read the Zen of Python yet open a Python prompt and type ‘import this’.For each of the item on the list you can find example here <a href="http://artifex.org/~hblanks/talks/2011/pep20_by_example.html" target="_blank" rel="noopener">http://artifex.org/~hblanks/talks/2011/pep20_by_example.html</a></p>
<p>One caught my attention:</p>
<p><strong>Beautiful is better then ugly</strong></p>
<p>Give me a function that takes a list of numbers and return only the even ones,divided by two.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#-----------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">halve_evens_only = lambda nums: map(lambda i: i/2, filter(lambda i: not i%2, nums))</span><br><span class="line"></span><br><span class="line">#-----------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">def halve_evens_only(nums):</span><br><span class="line">    return [i/2 for i in nums if not i % 2]</span><br></pre></td></tr></table></figure>
<h3 id="Remembar-the-very-simple-things-in-Python"><a href="#Remembar-the-very-simple-things-in-Python" class="headerlink" title="Remembar the very simple things in Python"></a>Remembar the very simple things in Python</h3><ul>
<li>Swaping two variables:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a,b = b, a</span><br></pre></td></tr></table></figure>
<ul>
<li>The step argument in slice operator. For example:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [1,2,3,4,5]</span><br><span class="line">&gt;&gt;&gt;a[::2] #iterate over the whole list in 2-increments</span><br><span class="line">[1,3,5]</span><br></pre></td></tr></table></figure>
<p>THe special case x[:-1:] is a useful idiom for ‘x reversed’.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;z[::-1]</span><br><span class="line">[5,4,3,2,1]</span><br></pre></td></tr></table></figure>
<p>UPDATE: Do keep in mind <code>x.reverse()</code> reverses the list in place and slices gives you the ability to do this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;x[::-1]</span><br><span class="line">[5,4,3,2,1]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;x[::-2]</span><br><span class="line">[5,3,1]</span><br></pre></td></tr></table></figure>
<h3 id="Don’t-use-mutables-as-defaults"><a href="#Don’t-use-mutables-as-defaults" class="headerlink" title="Don’t use mutables as defaults"></a>Don’t use mutables as defaults</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def function(x,l=[]):    #Don&apos;t do this</span><br><span class="line"></span><br><span class="line">def function(x,l=None):    #way better</span><br><span class="line">	if l is None:</span><br><span class="line">		l = []</span><br></pre></td></tr></table></figure>
<p>UPDATE: I realise I haven’t explained why. I would recommend reading the <a href="http://effbot.org/zone/default-values.htm" target="_blank" rel="noopener">article by Fredrik Lundh</a>. In short it is by design that this happens. “Default parameter values are always evaluted when, and only when, the “def” statement they belong to is executed;”</p>
<h3 id="Use-iteritems-rather-than-items"><a href="#Use-iteritems-rather-than-items" class="headerlink" title="Use iteritems rather than items"></a>Use iteritems rather than items</h3><p><code>iteritems</code> uses <code>generators</code> and thus are better whle iterating though very large lists.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;1:&apos;1&apos;,2:&apos;2&apos;,3:&apos;3&apos;&#125;</span><br><span class="line"></span><br><span class="line">for key, val in d.items()    # builds complete list when called.</span><br><span class="line"></span><br><span class="line">for key, val in d.iteritems()    # calls values only when requested.</span><br></pre></td></tr></table></figure>
<p>This is similar with <code>range</code> and <code>xrange</code> only calls values when requested.</p>
<p>UPDATE: Do note that the <code>iteritems,iterkeys,itervalues</code> are removed from Python3.x. The <code>dict.keys()</code>,<code>dict.items()</code> and ‘dict.values()’ return views instead of <code>lists</code>.</p>
<p><a href="http://docs.python.org/release/3.1.5/whatsnew/3.0.html#views-and-iterators-instead-of-lists" target="_blank" rel="noopener">http://docs.python.org/release/3.1.5/whatsnew/3.0.html#views-and-iterators-instead-of-lists</a></p>
<h3 id="Use-isinstance-rather-than-type"><a href="#Use-isinstance-rather-than-type" class="headerlink" title="Use isinstance rather than type"></a>Use <code>isinstance</code> rather than type</h3><p>Don’t do</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if type(s) == type(&quot;&quot;): ,,,</span><br><span class="line">if type(seq) == list or type(seq) == tuple: ...</span><br></pre></td></tr></table></figure>
<p>rather:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if isinstance(s, basestring): ...</span><br><span class="line">if isinstance(seq, (list, tuple)): ...</span><br></pre></td></tr></table></figure>
<p>For why not to do so: <a href="http://stackoverflow.com/a/1549854/504262" target="_blank" rel="noopener">http://stackoverflow.com/a/1549854/504262</a></p>
<p>Notice I used <code>basestring</code> and not <code>str</code> as you might be trying to check if a nuicode object is a string. For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = u&apos;aaa&apos;</span><br><span class="line">&gt;&gt;&gt; print isinstance(a, basestring)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; print isinstance(a, str)</span><br><span class="line">False</span><br></pre></td></tr></table></figure>
<p>This is because in Python version below 3.0 there are two string types <code>str</code> and <code>uuicode</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  object</span><br><span class="line">     |</span><br><span class="line">     |</span><br><span class="line">basestring</span><br><span class="line">    /\</span><br><span class="line">  /    \</span><br><span class="line">str   unicode</span><br></pre></td></tr></table></figure>
<h3 id="Learn-the-various-collection"><a href="#Learn-the-various-collection" class="headerlink" title="Learn the various collection"></a>Learn the various <code>collection</code></h3><p>Python has various container datatypes which are better alternative to the built-in containers like <code>list</code> and <code>dict</code> for specific cases.</p>
<p>UPDATE: I’m sure most do not use this. Carelessness from my side. A few may consider writing it this way:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">freqs = &#123;&#125;</span><br><span class="line">for c in &quot;abcdgfgdgddgf&quot;:</span><br><span class="line">  try:</span><br><span class="line">    freqs[c] += 1</span><br><span class="line">  except:</span><br><span class="line">    freqs[c] = 1</span><br></pre></td></tr></table></figure>
<p>Some may say a better solution would be:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">freqs = &#123;&#125;</span><br><span class="line">for c in &quot;fgsdcacacacscac&quot;:</span><br><span class="line">  freqs[c] = freqs.get(c,0) + 1</span><br></pre></td></tr></table></figure>
<p>Rether go for the <code>collection</code> type <code>defaultdict</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from collections import defaultdict</span><br><span class="line">freqs = defaultdict(int)</span><br><span class="line">for c in &quot;fgdhffjjg&quot;:</span><br><span class="line">  freqs[c] += 1</span><br></pre></td></tr></table></figure>
<p><strong>Other collections</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">namedtuple()    # factory function for creating tuple subclasses with named fields</span><br><span class="line">deque    #list-like container with fast appends and pops on either end</span><br><span class="line">Counter    #dict subclass for counting hashable objects</span><br><span class="line">OrderedDict    #dict subclass that remembers the order entries were added</span><br><span class="line">defaultdict    #dict subclass that calls a factory function to supply missing values</span><br></pre></td></tr></table></figure>
<p>UPDATE: As noted by a few in Hacker News I could have used <code>Counter</code> instead of <code>defaultdict</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import Counter</span><br><span class="line">&gt;&gt;&gt; c = Counter(&quot;ghdgdfgfhgfhgfh&quot;)</span><br><span class="line">&gt;&gt;&gt; c[&apos;d&apos;]</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<h3 id="When-creating-classes-Python’s-magic-methods"><a href="#When-creating-classes-Python’s-magic-methods" class="headerlink" title="When creating classes Python’s magic methods"></a>When creating classes Python’s magic methods</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__eq__(self, other)    # Defines behavior for the equality operator, ==</span><br><span class="line">__ne__(self,other)    # Defines behavior for the inequality operator, !=</span><br><span class="line">__lt__(self,other)     # Defines behavior for the less-than operator, &lt;.</span><br><span class="line">  __gt__(self, other)      # Defines behavior for the greater-than operator, &gt;.</span><br><span class="line">  __le__(self, other)      # Defines behavior for the less-than-or-equal-to operator, &lt;=.</span><br><span class="line">  __ge__(self, other)      # Defines behavior for the greater-than-or-equal-to operator, &gt;=.</span><br></pre></td></tr></table></figure>
<p>There are serveral others.</p>
<h3 id="Conditional-Assignments"><a href="#Conditional-Assignments" class="headerlink" title="Conditional Assignments"></a>Conditional Assignments</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = 3 if (y == 1) else 2    It does exactly what it sounds like:&quot;assign 3 to x if y is 1, otherwise assign 2 to x&quot;, You can also chain it if you have something more complicated:</span><br><span class="line">x = 3 if (y == 1) else 2 if (y == -1) else 1</span><br></pre></td></tr></table></figure>
<p>Though at a certain point, it goes a little too far.</p>
<p>Note that you can use if … else in any expression. For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(func1 if y == 1 else func2)(arg1, arg2)</span><br></pre></td></tr></table></figure>
<p>Here <code>func1</code> will be called if y is 1 and func2. otherwise. In both cases the corresponding function will be called with arguments arg1 and arg2.</p>
<p>Analogously, the following is also valid:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x = (class1 if y == 1 else class2)(arg1, arg2)</span><br></pre></td></tr></table></figure>
<p>where <code>class1</code> and <code>class2</code> are two classes.</p>
<h3 id="Use-the-Ellipsis-when-necessary"><a href="#Use-the-Ellipsis-when-necessary" class="headerlink" title="Use the Ellipsis when necessary."></a>Use the <code>Ellipsis</code> when necessary.</h3><p>UPDATE: As one commenter mentioned in Hacker News “Using Ellipsis for getting all items is a violation of the only One Way TO Do It principle. The standard notation is [:].” I do agree with him. A better example is given using numpy in <a href="http://stackoverflow.com/a/118508/504262" target="_blank" rel="noopener">stackoverflow</a>:</p>
<p>The ellipsis is used to slice higher-dimensional data structures.</p>
<p>It’s designed to mean at this point. insert as many full slices(:) to extend the multi-dimensional slice to all dimensions.</p>
<p>Example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from numpy import arrage</span><br><span class="line">&gt;&gt;&gt; a = arange(16).reshape(2,2,2,2)</span><br></pre></td></tr></table></figure>
<p>Now, you have a 4-dimensional matrix of order 2x2x2x2. To select all first elements in the 4th dimension, you can use the ellipsis notation</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a[...,0].flatten()</span><br><span class="line">array([0,2,4,6,8,10,12,14])</span><br></pre></td></tr></table></figure>
<p><strong>Previous suggestion.</strong></p>
<p>When creating a class you can use <code>__gititem__</code> to make you class’s object work like a dictionary. Take this class as an example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class MyCLass(object):</span><br><span class="line">  def __init__(self,a,b,c,d):</span><br><span class="line">    self.a, self.b,self.c,self.d = a,b,c,d</span><br><span class="line"></span><br><span class="line">  def __getitem__(self, item):</span><br><span class="line">    return getattr(self,item)</span><br><span class="line"></span><br><span class="line">x = MyCLass(10,12,22,14)</span><br></pre></td></tr></table></figure>
<p>Because of <code>__getitem__</code> you will be able to get the value of <code>a</code> in the object <code>x</code> by <code>x[&#39;a&#39;]</code>. This is probably a know fact.</p>
<p>This object is used to extend the Python slicing.(<a href="(http://docs.python.org/library/stdtypes.html#bltin-ellipsis-object">(http://docs.python.org/library/stdtypes.html#bltin-ellipsis-object</a>). Thus if we add a clause:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def __getitem__(self,item):</span><br><span class="line">  if item is Ellipsis:</span><br><span class="line">    return [self.a, self.b,self.c, self.d]</span><br><span class="line">  else:</span><br><span class="line">    return getattr(self, item)</span><br></pre></td></tr></table></figure>
<p>We can use <code>x[...]</code> to get list containing all the items.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; x = MyCLass(11,24,23,12)</span><br><span class="line">&gt;&gt;&gt; x[...]</span><br><span class="line">(11,24,23,12)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2016/05/14/a-few-things-to-remember-while-coding-in-python/" data-id="cm50h3r9n0048yfht9dw5i1tb" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2016/05/14/a-few-things-to-remember-while-coding-in-python/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ipython-notebook-introduction-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/10/ipython-notebook-introduction-1/" class="article-date">
  <time datetime="2016-05-09T16:00:00.000Z" itemprop="datePublished">2016-05-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/10/ipython-notebook-introduction-1/">IPython Notebook Introduction 1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>This article will introduce some base usage for ipython notebook.</em></p>
<p>IPython Notebook使用浏览器作为界面，向后台的IPython服务器发送请求，并显示结果。在浏览器的界面中使用单元(Cell)保存各种信息。Cell有多种类型，经常使用的有表示格式化文本的Markdown单元，和表示代码的Code单元。</p>
<p>每个代码单元都有一个输出区域，在Code单元中输入代码，按 Shift-Enter 将运行此代码，代码中最后一个表达式的值将输出区域显示。如果希望屏蔽输出，可以在最后一条语句之后添加一个分号：”;”。此外，代码中还可以使用print语句在输出区域中显示信息。</p>
<p>在Markdown单元中还可以直接使用Html和Javascript</p>
<h2 id="数学公式"><a href="#数学公式" class="headerlink" title="数学公式"></a>数学公式</h2><p>在Markdown单元中可以使用LaTeX表示数学公式，例如\sqrt{x^2+y^2}。数学公式的显示使用MathJax，缺省情况下，MathJax从网络上下载，如果希望离线使用它，需要在IPython Notebook中输入如下代码，把MathJax安装到本地磁盘中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from IPython.external.mathjax import install_mathjax</span><br><span class="line">install_mathjax()</span><br></pre></td></tr></table></figure>
<p>Code单元的输出也可以显示为数学公式，例如在单元中输入如下代码，将显示为数学公式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from IPython.display import Latex</span><br><span class="line">Latex(r&quot;$\sqrt&#123;x^2+y^2&#125;$&quot;)</span><br></pre></td></tr></table></figure></p>
<p>\sqrt{x^2+y^2}</p>
<p>SymPy的表达式也可以显示为LaTex，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%load_ext sympyprinting</span><br><span class="line">from sympy import *</span><br><span class="line">x, y = symbols(&quot;x,y&quot;)</span><br><span class="line">sqrt(x**2+y**2)</span><br></pre></td></tr></table></figure></p>
<p>\sqrt{x^{2} + y^{2}}</p>
<p>以%开头的为IPython的命令(Magic Command)，这里通过%load_ext命令载入sympyprinting扩展插件，载入此插件之后，所有的SymPy表达式都显示为数学公式。</p>
<h2 id="各种显示"><a href="#各种显示" class="headerlink" title="各种显示"></a>各种显示</h2><p>IPython.display模块中提供了许多显示Python返回值的类，例如下面的代码用Image类显示”python.png”图片，缺省路径为Notebook文件所在的目录：</p>
<pre>
from IPython.display import Image
Image(filename="python.png")
</pre>


<p>Image还可以用来显示表示图像的字符串。例如下面的代码通过cv2的imencode()将NumPy数组转换为一个表示PNG图像数据的数组，然后将此数组转换为字符串之后通过Image()将显示为图像：</p>
<pre>
import cv2
import numpy as np
from IPython.display import Image
img = np.random.randint(0,255,(250,250,3))
cv2.blur(img, (11,11), img)
r, dat = cv2.imencode(".png",img)
Image(dat.tostring())
</pre>


<p>此外，还可以通过HTML和Javascript将Python代码的输出显示为Html，或者作为Javascript运行。</p>
<pre>
from IPython.display import Javascript
Javascript("alert('ok')")
</pre>


<p>将在浏览器中运行Javascript代码。</p>
<h2 id="Magic命令"><a href="#Magic命令" class="headerlink" title="Magic命令"></a>Magic命令</h2><p>IPython中Magic命令有两种执行方式，以%开始的命令被称为行命令，它只对单行有效，以%%开头的为单元命令，它放在单元的第一行，对整个单元有效。例如timeit命令可以快速测试代码的执行效率，它可以作为行命令或者单元命令。</p>
<pre>
%timeit 1 + 1
%timeit 1.0 + 1.0
%timeit "1" + "1"
</pre>


<pre>
10000000 loops, best of 3: 52 ns per loop
10000000 loops, best of 3: 53.4 ns per loop
10000000 loops, best of 3: 50.9 ns per loop
</pre>


<pre>
%%timeit
s = 0
for i in xrange(100):
    s += i
</pre>


<pre>
100000 loops, best of 3: 11 us per loop
</pre>


<p>每个Magic命令都可以指定参数，可以输入timeit?查看其帮助文档。下面让我们看看一些常用的Magic命令。</p>
<p><strong>%pylab</strong>命令将载入numpy和pylab，并且将这两个模块中的名字载入到全局名字空间中。缺省参数时，它使用matplotlib的缺省界面库显示图表，如果带inline参数则将图表作为图像插入到Notebook中。使用界面库显示图像时可以使用交互工具，而将图表直接插入到Notebook中则有利于编写文档。</p>
<p>下面的例子，plot和random是从pylab和numpy中载入的。</p>
<pre>
%pylab inline
plot(random.randn(100));
</pre>


<pre>
Welcome to pylab, a matplotlib-based Python environment [backend: module://IPython.zmq.pylab.backend_inline].
For more information, type 'help(pylab)'.
</pre>


<p><strong>%load</strong>可以从文件或者网址载入代码到一个新的单元中，例如下面载入某个matplotlib的示例程序，并执行：</p>
<pre>
%load http://matplotlib.org/mpl_examples/pylab_examples/histogram_demo.py
</pre>


<pre>
\#!/usr/bin/env python
import numpy as np
import matplotlib.mlab as mlab
import matplotlib.pyplot as plt

mu, sigma = 100, 15
x = mu + sigma*np.random.randn(10000)

\# the histogram of the data
n, bins, patches = plt.hist(x, 50, normed=1, facecolor='green', alpha=0.75)

\# add a 'best fit' line
y = mlab.normpdf( bins, mu, sigma)
l = plt.plot(bins, y, 'r--', linewidth=1)

plt.xlabel('Smarts')
plt.ylabel('Probability')
plt.title(r'$\mathrm{Histogram\ of\ IQ:}\ \mu=100,\ \sigma=15$')
plt.axis([40, 160, 0, 0.03])
plt.grid(True)

plt.show()
</pre>


<p><strong>%prun</strong>用于代码的执行性能分析，可以作为行命令和单元命令使用。下面的程序分析numpy.linalg.det()的性能：</p>
<pre>
%%prun
for i in xrange(100):
    linalg.det(random.rand(10,10))
</pre>


<p>其输出如下：</p>
<pre>
3402 function calls in 0.096 seconds

Ordered by: internal time

ncalls  tottime  percall  cumtime  percall filename:lineno(function)
   100    0.032    0.000    0.091    0.001 linalg.py:1560(slogdet)
   300    0.022    0.000    0.022    0.000 {method 'reduce' of 'numpy.ufunc' objects}
   200    0.011    0.000    0.012    0.000 numeric.py:167(asarray)
   100    0.006    0.000    0.006    0.000 linalg.py:84(_realType)
   100    0.005    0.000    0.005    0.000 linalg.py:151(_assertRank2)
   ...
</pre>


<p><strong>%load_ext</strong>载入IPython的扩展模块，通过它可以载入更多的Magic命令。下面我们载入cythonmagic模块，并使用%%cython命令编译一个高效的频率统计函数count()。</p>
<pre>
%load_ext cythonmagic
</pre>


<h2 id="测试Cython代码"><a href="#测试Cython代码" class="headerlink" title="测试Cython代码"></a>测试Cython代码</h2><p>Cython的代码基本和Python的代码类似，但是可以使用类型声明，Cython可以使用这些类型声明产生更高效的C语言代码，并编译成Python的扩展模块。使用%%cython命令简化了编译扩展模块的过程，它会自动创建C语言程序，编译并载入。由于扩展模块无法卸载，因此IPython采用的策略是每次编译不同的代码都会产生一个全新的扩展模块。方便我们不退出Python环境即可运行新的代码。</p>
<pre>
\%%cython
def count(list data):
    cdef:
    dict result = {}
    int i, length = len(data)
    object item

    for i in range(length):
    item = data[i]
    if item in result:
        (<list> result[item]).append(i)
    else:
        result[item] = return result
    return result
</list></pre>


<p>下面是count()的Python版本。</p>
<pre>
from collections import defaultdict
def countpy(data):
    result = defaultdict(list)
    for i,item in enumerate(data):
    result[item].append(i)
    return result
</pre>


<p>先测试二者的结果是否相同：</p>
<pre>
import random
data = [random.randint(0,100) for _ in xrange(10000)]
count(data) == countpy(data)
</pre>


<pre>
True
</pre>


<p>然后测试它们的执行速度，可以看出Cython版本比Python的要快2倍多。在这个测试中，Cython程序也同样使用列表和字典等对象，但是由于可以直接调用Python的C API，因此Cython版本的效率能提高几倍。如果只是单纯的数值运算，Cython能将程序提升到与C语言相近的速度。</p>
<pre>
\%timeit countpy(data)
\%timeit count(data)
</pre>


<pre>
100 loops, best of 3: 4.52 ms per loop
1000 loops, best of 3: 1.8 ms per loop
</pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2016/05/10/ipython-notebook-introduction-1/" data-id="cm50h3r9l0044yfht9gyzj45o" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2016/05/10/ipython-notebook-introduction-1/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-creating-volcano-maps-with-pandas-and-the-matplotlib-basemap-toolkit" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/09/creating-volcano-maps-with-pandas-and-the-matplotlib-basemap-toolkit/" class="article-date">
  <time datetime="2016-05-08T16:00:00.000Z" itemprop="datePublished">2016-05-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/09/creating-volcano-maps-with-pandas-and-the-matplotlib-basemap-toolkit/">Creating Volcano Maps with Pandas and the Matplotlib Basemap Toolkit</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>Creating Volcano Maps with Pandas and the Matplotlib Basemap Toolkit</em></p>
<p>Transfer from <a href="http://ramiro.org/notebook/mapping-volcanoes/" target="_blank" rel="noopener">http://ramiro.org/notebook/mapping-volcanoes/</a></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>This notebook walks through the process of creating maps of volcanoes with Python. The main steps involve getting, cleaning and finally mapping the data.</p>
<p>All Python 3rd party packages used, except the Matplotlib Basemap Toolkit, are included with the Anaconda distribution and installed when you create an anaconda environment. To add Basemap simply run the command conda install basemap in your activated anaconda environment. To follow the code you should be familiar with Python, Pandas and Matplotlib.</p>
<h2 id="Get-into-work"><a href="#Get-into-work" class="headerlink" title="Get into work"></a>Get into work</h2><p>First load all Python libraries required in this notebook.</p>
<pre>
%load_ext signature
%matplotlib inline

import json

from lxml import html
from mpl_toolkits.basemap import Basemap

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

chartinfo = 'Author: Ramiro Gomez - ramiro.org | Data: Volcano World - Volcano.oregonstate.edu'
</pre>


<h2 id="Get-the-volcano-data"><a href="#Get-the-volcano-data" class="headerlink" title="Get the volcano data"></a>Get the volcano data</h2><p>The data is downloaded and parsed using lxml. The Volcano World source page lists the volcano data in several HTML tables, which are each read into individual Pandas data frames that are appended to a list of data frames. Since the page also uses tables for layout the first four tables are omitted.</p>
<pre>
url ='http://volcano.oregonstate.edu/oldroot/volcanoes/alpha.html'
xpath='//table'
tree = html.parse(url)
tables = tree.xpath(xpath)

table_dfs = []
for idx in range(4, len(tables)):
    df = pd.read_html(html.tostring(tables[idx]), header=0)[0]
        table_dfs.append(df)
</pre>


<p>The next step is to create a single data frame from the ones in the list using Pandas’ concat method. To create a new index with consecutive numbers the index_ignore parameter is set to True.</p>
<pre>
df_volc = pd.concat(table_dfs, ignore_index=True)
</pre>


<p>Let’s take a look at the data contained in the newly created data frame.</p>
<pre>
print(len(df_volc))
df_volc.head(10)
</pre>


<pre>
1560
</pre>


<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">Name</th>
<th style="text-align:center">Location</th>
<th style="text-align:center">Type</th>
<th style="text-align:center">Latitude</th>
<th style="text-align:center">Longitude</th>
<th style="text-align:center">Elevation (m)</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td style="text-align:center">Abu</td>
<td style="text-align:center">Honshu-Japan</td>
<td style="text-align:center">Shield volcanoes</td>
<td style="text-align:center">34.50</td>
<td style="text-align:center">131.60</td>
<td style="text-align:center">641</td>
</tr>
<tr>
<td>1</td>
<td style="text-align:center">Acamarachi</td>
<td style="text-align:center">Chile-N</td>
<td style="text-align:center">Stratovolcano</td>
<td style="text-align:center">-23.30</td>
<td style="text-align:center">-67.62</td>
<td style="text-align:center">6046</td>
</tr>
<tr>
<td>2</td>
<td style="text-align:center">Acatenango</td>
<td style="text-align:center">Guatemala</td>
<td style="text-align:center">Stratovolcano</td>
<td style="text-align:center">14.50</td>
<td style="text-align:center">-90.88</td>
<td style="text-align:center">3976</td>
</tr>
<tr>
<td>3</td>
<td style="text-align:center">Acigöl-Nevsehir</td>
<td style="text-align:center">Turkey</td>
<td style="text-align:center">Caldera</td>
<td style="text-align:center">38.57</td>
<td style="text-align:center">34.52</td>
<td style="text-align:center">1689</td>
</tr>
<tr>
<td>4</td>
<td style="text-align:center">Adams</td>
<td style="text-align:center">US-Washington</td>
<td style="text-align:center">Stratovolcano</td>
<td style="text-align:center">46.21</td>
<td style="text-align:center">-121.49</td>
<td style="text-align:center">3742</td>
</tr>
<tr>
<td>5</td>
<td style="text-align:center">Adams Seamount</td>
<td style="text-align:center">Pacific-C</td>
<td style="text-align:center">Submarine volcano</td>
<td style="text-align:center">-25.37</td>
<td style="text-align:center">-129.27</td>
<td style="text-align:center">-39</td>
</tr>
<tr>
<td>6</td>
<td style="text-align:center">Adatara</td>
<td style="text-align:center">Honshu-Japan</td>
<td style="text-align:center">Stratovolcanoes</td>
<td style="text-align:center">37.64</td>
<td style="text-align:center">140.29</td>
<td style="text-align:center">1718</td>
</tr>
<tr>
<td>7</td>
<td style="text-align:center">Adwa</td>
<td style="text-align:center">Ethiopia</td>
<td style="text-align:center">Stratovolcano</td>
<td style="text-align:center">10.07</td>
<td style="text-align:center">40.84</td>
<td style="text-align:center">1733</td>
</tr>
<tr>
<td>8</td>
<td style="text-align:center">Afderà</td>
<td style="text-align:center">Ethiopia</td>
<td style="text-align:center">Stratovolcano</td>
<td style="text-align:center">13.08</td>
<td style="text-align:center">40.85</td>
<td style="text-align:center">1295</td>
</tr>
<tr>
<td>9    Agrigan</td>
<td style="text-align:center">Mariana Is-C Pacific</td>
<td style="text-align:center">Stratovolcano</td>
<td style="text-align:center">18.77</td>
<td style="text-align:center">145.67</td>
<td style="text-align:center">965</td>
</tr>
</tbody>
</table>
<pre>
df_volc['Type'].value_counts()
</pre>


<pre>
Stratovolcano           601
Shield volcano          121
Stratovolcanoes         109
Submarine volcano        95
Volcanic field           82
Caldera                  78
Cinder cones             62
Complex volcano          49
Shield volcanoes         31
Pyroclastic cones        30
Lava domes               26
Submarine volcano ?      19
Volcanic  field          16
Fissure vents            16
Shield  volcano          16
Submarine  volcano       16
Maars                    12
Compound volcano         10
Cinder  cones            10
Lava dome                 9
Cinder cone               9
Calderas                  9
Pyroclastic cone          8
Tuff cones                7
Scoria cones              7
Maar                      7
Unknown                   6
Complex  volcano          6
Somma volcano             5
Lava  domes               5
                 ...
Subglacial  volcano       2
Lava cone                 2
Explosion craters         2
Fissure vent              2
Fissure  vents            2
Volcanic Landform         1
Tuff  cone                1
Lava  cone                1
Compound  volcano         1
Scoria  cones             1
Lava Cone                 1
Lava cones                1
Lava Field                1
Somma volcanoes           1
Submarine  volcano ?      1
Cinder Cone               1
Flood  Basalt             1
Flood Basalts             1
Cone                      1
Lava  dome                1
Shield volcanoe           1
Pyroclastic  cone         1
Stratovolcano  ?          1
Complex volcanoes         1
Cones                     1
Island Arc                1
Tuff  rings               1
Crater  rows              1
Hydrothermal field        1
Pumice cone               1
dtype: int64
</pre>


<p>Looking at the output we see that a single type may be represented by diffent tokens, for example Stratvolcano and Stratvolcanoes refer to the same type. Sometimes entries contain question marks, indicating that the classification may not be correct.</p>
<h2 id="Cleaning-the-data"><a href="#Cleaning-the-data" class="headerlink" title="Cleaning the data"></a>Cleaning the data</h2><p>The next step is to clean the data. I decided to take the classification for granted and simply remove question marks. Also, use one token for each type and change the alternative spellings accordingly. Finally remove superfluous whitespace and start all words with capital letter.</p>
<pre>
def cleanup_type(s):
    if not isinstance(s, str):
            return s
    s = s.replace('?', '').replace('  ', ' ')
    s = s.replace('volcanoes', 'volcano')
    s = s.replace('volcanoe', 'Volcano')
    s = s.replace('cones', 'cone')
    s = s.replace('Calderas', 'Caldera')
    return s.strip().title()

df_volc['Type'] = df_volc['Type'].map(cleanup_type)
df_volc['Type'].value_counts()
</pre>


<pre>
Stratovolcano         713
Shield Volcano        173
Submarine Volcano     137
Volcanic Field         98
Caldera                87
Cinder Cone            84
Complex Volcano        56
Pyroclastic Cone       43
Lava Domes             31
Fissure Vents          18
Tuff Cone              14
Maars                  12
Compound Volcano       11
Lava Dome              10
Scoria Cone             8
Pyroclastic Shield      8
Maar                    7
Unknown                 6
Somma Volcano           6
Subglacial Volcano      6
Crater Rows             5
Lava Cone               5
Fumarole Field          3
Pumice Cone             3
Explosion Craters       2
Volcanic Complex        2
Fissure Vent            2
Flood Basalt            1
Cones                   1
Hydrothermal Field      1
Island Arc              1
Cone                    1
Volcanic Landform       1
Lava Field              1
Tuff Rings              1
Flood Basalts           1
dtype: int64
</pre>


<p>Now let’s get rid of incomplete records.</p>
<pre>
df_volc.dropna(inplace=True)
len(df_volc)
</pre>


<pre>
1513
</pre>


<h2 id="Creating-the-maps"><a href="#Creating-the-maps" class="headerlink" title="Creating the maps"></a>Creating the maps</h2><p>Volcanoes will be plotted as red triangles, whose sizes depend on the elevation values, that’s why I’ll only consider positive elevations, i. e. remove submarine volcanoes from the data frame.</p>
<pre>
df_volc = df_volc[df_volc['Elevation (m)'] >= 0]
len(df_volc)
</pre>


<pre>
1406
</pre>


<p>Next I define a function that will plot a volcano map for the given parameters. Lists of longitudes, latitudes and elevations, that all need to have the same lengths, are mandatory, the other parameters have defaults set.</p>
<p>As mentioned above, sizes correspond to elevations, i. e. a higher volcano will be plotted as a larger triangle. To achieve this the 1st line in the plot_map function creates an array of bins and the 2nd line maps the individual elevation values to these bins.</p>
<p>Next a Basemap object is created, coastlines and boundaries will be drawn and continents filled in the given color. Then the volcanoes are plotted. The 3rd parameter of the plot method is set to ^r, the circumflex stands for triangle and r for red. For more details, see the documentation for plot.</p>
<p>The Basemap object will be returned so it can be manipulated after the function finishes and before the map is plotted, you’ll see why in a later example.</p>
<pre>
def plot_map(lons, lats, elevations, projection='mill', llcrnrlat=-80, urcrnrlat=90, llcrnrlon=-180, urcrnrlon=180, resolution='i', min_marker_size=2):
    bins = np.linspace(0, elevations.max(), 10)
    marker_sizes = np.digitize(elevations, bins) + min_marker_size

    m = Basemap(projection=projection, llcrnrlat=llcrnrlat, urcrnrlat=urcrnrlat, llcrnrlon=llcrnrlon, urcrnrlon=urcrnrlon, resolution=resolution)
    m.drawcoastlines()
    m.drawmapboundary()
    m.fillcontinents(color = '#333333')

    for lon, lat, msize in zip(lons, lats, marker_sizes):
        x, y = m(lon, lat)
        m.plot(x, y, '^r', markersize=msize, alpha=.7)

    return m
</pre>


<h2 id="Map-of-Stratovolcanos"><a href="#Map-of-Stratovolcanos" class="headerlink" title="Map of Stratovolcanos"></a>Map of Stratovolcanos</h2><p>The 1st map shows the locations of Stratovolcanoes on a world map, so the data frame is filtered on the type column beforehand.</p>
<pre>
plt.figure(figsize=(16, 8))
df = df_volc[df_volc['Type'] == 'Stratovolcano']
plot_map(df['Longitude'], df['Latitude'], df['Elevation (m)'])
plt.annotate('Stratovolcanoes of the world | ' + chartinfo, xy=(0, -1.04), xycoords='axes fraction')
</pre>


<p><img src="./_posts/images/20160510/mapping-volcanoes_19_1.png" alt="images/20160510/mapping-volcanoes_19_1.png"></p>
<p>We can clearly see that most Stratovolcanoes are located, where tectonic plates meet. Let’s look at all volcanoes of some of those regions now.</p>
<h2 id="Volcanoes-of-North-America"><a href="#Volcanoes-of-North-America" class="headerlink" title="Volcanoes of North America"></a>Volcanoes of North America</h2><p>The next map shows all North American volcanoes in the data frame. To display only that part of the map the parameters that determine the bounding box are set accordingly, i. e. the latitudes and longitudes of the lower left and upper right corners of the bounding box.</p>
<pre>
plt.figure(figsize=(12, 10))
plot_map(df_volc['Longitude'], df_volc['Latitude'], df_volc['Elevation (m)'],
         llcrnrlat=5.5, urcrnrlat=83.2, llcrnrlon=-180, urcrnrlon=-52.3, min_marker_size=4)
     plt.annotate('Volcanoes of North America | ' + chartinfo, xy=(0, -1.03), xycoords='axes fraction')
</pre>


<p><img src="./images/20160510/mapping-volcanoes_22_1.png" alt="./images/20160510/mapping-volcanoes_22_1.png"></p>
<h2 id="Volcanoes-of-Indonesia"><a href="#Volcanoes-of-Indonesia" class="headerlink" title="Volcanoes of Indonesia"></a>Volcanoes of Indonesia</h2><p>Another region with many volcanoes is the Indonesian archipelago. Some of them like the Krakatoa and Mount Tambora have undergone catastrophic eruptions with tens of thousands of victims in the past 200 years.</p>
<pre>
plt.figure(figsize=(18, 8))
plot_map(df_volc['Longitude'], df_volc['Latitude'], df_volc['Elevation (m)'],
         llcrnrlat=-11.1, urcrnrlat=6.1, llcrnrlon=95, urcrnrlon=141.1, min_marker_size=4)
     plt.annotate('Volcanoes of Indonesia | ' + chartinfo, xy=(0, -1.04), xycoords='axes fraction'
</pre>


<p><img src="./images/20160510/mapping-volcanoes_24_1.png" alt="/images/20160510/mapping-volcanoes_24_1.png"></p>
<h2 id="Volcanoes-of-the-world"><a href="#Volcanoes-of-the-world" class="headerlink" title="Volcanoes of the world"></a>Volcanoes of the world</h2><p>The final map shows all volcanoes in the data frame and the whole map using a background image obtained from the NASA Web site. To be able to add this image to the map by calling the warpimage method, is why the plot_map function returns the Basemap object. Moreover, a title and an annotation are added with the code below.</p>
<pre>
plt.figure(figsize=(20, 12))
m = plot_map(df_volc['Longitude'], df_volc['Latitude'], df_volc['Elevation (m)'], min_marker_size=2)
m.warpimage(image='img/raw-bathymetry.jpg', scale=1)

plt.title('Volcanoes of the World', color='#000000', fontsize=40)
plt.annotate(chartinfo + ' | Image: NASA - nasa.gov',
             (0, 0), color='#bbbbbb', fontsize=11)plt.show()
plt.show()
</pre>


<p><img src="../../../../_posts/images/20160510/mapping-volcanoes_26_1.png" alt="./_posts/images/20160510/mapping-volcanoes_26_1.png"></p>
<h2 id="Bonus-volcano-globe"><a href="#Bonus-volcano-globe" class="headerlink" title="Bonus: volcano globe"></a>Bonus: volcano globe</h2><p>In addition to these static maps I created this volcano globe. It is built with the WebGL globe project, that expects the following data structure [ latitude, longitude, magnitude, latitude, longitude, magnitude, … ].</p>
<p>To achieve this structure, I create a data frame that contains only latitude, longitude, and elevation, call the as_matrix method which creates an array with a list of lists containing the column values, flatten this into a 1-dimensional array, turn it to a list and save the new data structure as a JSON file.</p>
<pre>
df_globe_values = df_volc[['Latitude', 'Longitude', 'Elevation (m)']]
globe_values = df_globe_values.as_matrix().flatten().tolist()
with open('json/globe_volcanoes.json', 'w') as f:
    json.dump(globe_values, f)
</pre>


<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>This notebook shows how you can plot maps with locations using Pandas and Basemap. This was a rather quick walk-through, which did not go into too much detail explaining the code. If you like to learn more about the topic, I highly recommend the Mapping Global Earthquake Activity tutorial, which is more in-depth and contains various nice examples. Have fun mapping data with Python!</p>
<pre>
%signature
</pre>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2016/05/09/creating-volcano-maps-with-pandas-and-the-matplotlib-basemap-toolkit/" data-id="cm50h3r9m0046yfhteqi8qiy4" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2016/05/09/creating-volcano-maps-with-pandas-and-the-matplotlib-basemap-toolkit/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-tornado-web-framework-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/08/tornado-web-framework-2/" class="article-date">
  <time datetime="2016-03-07T16:00:00.000Z" itemprop="datePublished">2016-03-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/08/tornado-web-framework-2/">Tornado Web Framework 2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><em>Tornado Web Framework 2 Form and Module</em></p>
<p><em>文章转自<a href="http://demo.pythoner.com/itt2zh/ch2.html" target="_blank" rel="noopener">这里</a></em></p>
<p>在第一章中，我们学习了使用Tornado创建一个Web应用的基础知识。包括处理函数、HTTP方法以及Tornado框架的总体结构。在这章中，我们将学习一些你在创建Web应用时经常会用到的更强大的功能。</p>
<p>和大多数Web框架一样，Tornado的一个重要目标就是帮助你更快地编写程序，尽可能整洁地复用更多的代码。尽管Tornado足够灵活，可以使用几乎所有Python支持的模板语言，Tornado自身也提供了一个轻量级、快速并且灵活的模板语言在tornado.template模块中。</p>
<h2 id="2-1-简单示例：Poem-Maker-Pro"><a href="#2-1-简单示例：Poem-Maker-Pro" class="headerlink" title="2.1 简单示例：Poem Maker Pro"></a>2.1 简单示例：Poem Maker Pro</h2><p>让我们以一个叫作Poem Maker Pro的简单例子开始。Poem Maker Pro这个Web应用有一个让用户填写的HTML表单，然后处理表单的结果。代码清单2-1是它的Python代码。</p>
<p><em>代码清单2-1 简单表单和模板：poemmaker.py</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import os.path</span><br><span class="line">import tornado.httpserver</span><br><span class="line">import tornado.ioloop</span><br><span class="line">import tornado.options</span><br><span class="line">import tornado.web</span><br><span class="line"></span><br><span class="line">from tornado.options import define, options</span><br><span class="line">define(&quot;port&quot;, default=8000, help=&quot;run on the given port&quot;, type=int)</span><br><span class="line"></span><br><span class="line">class IndexHandler(tornado.web.RequestHandler):</span><br><span class="line">	def get(self):</span><br><span class="line">		self.render(&quot;index.html&quot;)</span><br><span class="line"></span><br><span class="line">class PoemPageHandler(tornado.web.RequestHandler):</span><br><span class="line">	def post(self):</span><br><span class="line">		noun1 = self.get_argument(&apos;noun1&apos;)</span><br><span class="line">		noun2 = self.get_argument(&apos;noun2&apos;)</span><br><span class="line">		verb = self.get_argument(&apos;verb&apos;)</span><br><span class="line">		noun3 = self.get_argument(&apos;noun3&apos;)</span><br><span class="line">		self.render(&apos;poem.html&apos;, roads=noun1, wood=noun2, made=verb, difference=noun3)</span><br><span class="line"></span><br><span class="line">if __name__==&apos;__main__&apos;:</span><br><span class="line">	tornado.options.parse_command_line()</span><br><span class="line">	app = tornado.web.Application(</span><br><span class="line">		handler=[(r&apos;/&apos;, IndexHandler),(r&apos;/poem&apos;, PoemPageHandler)],</span><br><span class="line">		template_path = os.path.join(os.path.dirname(__file__), &apos;templates&apos;)</span><br><span class="line">	)</span><br><span class="line">		http_server = tornado.httpserver.HTTPServer(app)</span><br><span class="line">		http_server.listen(options.port)</span><br><span class="line">		tornado.ioloop.IOLoop.instance().start()</span><br></pre></td></tr></table></figure>
<p>除了poemmaker.py，你还需要将代码清单2-2和代码清单2-3中的两个文件加入到templates子文件夹中。</p>
<p><em>代码清单2-2 Poem Maker表单：index.html</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;&lt;title&gt;Poem Marker Pro&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;h1&gt;Enter terms below.&lt;/h1&gt;</span><br><span class="line">		&lt;form method=&quot;post&quot; action=&quot;/poem&quot;&gt;</span><br><span class="line">			&lt;p&gt;Plural noun&lt;br&gt;</span><br><span class="line">			&lt;input type=&quot;text&quot; name=&quot;noun1&quot;&gt;&lt;/p&gt;</span><br><span class="line">			&lt;p&gt;&lt;input type=&quot;text&quot; name=&quot;noun2&quot;&gt;&lt;/p&gt;</span><br><span class="line">			&lt;p&gt;&lt;input type=&quot;text&quot; name=&quot;verb&quot;&gt;&lt;/p&gt;</span><br><span class="line">			&lt;p&gt;&lt;input type=&quot;text&quot; name=&quot;noun3&quot;&gt;&lt;/p&gt;</span><br><span class="line">			&lt;input type=&quot;submit&quot;&gt;</span><br><span class="line">		&lt;/form&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><em>代码清单2-3 Poem Maker模板：poem.html</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;title&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Your poem&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;Two &#123;&#123;roads&#125;&#125; diverged in a &#123;&#123;wood&#125;&#125;, and I—&lt;br&gt;</span><br><span class="line">I took the one less travelled by,&lt;br&gt;</span><br><span class="line">And that has &#123;&#123;made&#125;&#125; all the &#123;&#123;difference&#125;&#125;.&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>在命令行执行下述命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python poemmaker.py --port=8000</span><br></pre></td></tr></table></figure>
<p>现在，在浏览器中打开<a href="http://localhost:8000。当浏览器请求根目录（/）时，Tornado程序将渲染index.html，展示如图2-1所示的简单HTML表单。" target="_blank" rel="noopener">http://localhost:8000。当浏览器请求根目录（/）时，Tornado程序将渲染index.html，展示如图2-1所示的简单HTML表单。</a></p>
<p>这个表单包括多个文本域（命名为noun1、noun2等），其中的内容将在用户点击”Submit”按钮时以POST请求的方式送到/poem。现在往里面填写东西然后点击提交吧。</p>
<p>为了响应这个POST请求，Tornado应用跳转到poem.html，插入你在表单中填写的值。结果是Robert Frost的诗《The Road Not Taken》的轻微修改版本。图2-2展示了这个结果。</p>
<h4 id="2-1-1-渲染模板"><a href="#2-1-1-渲染模板" class="headerlink" title="2.1.1 渲染模板"></a>2.1.1 渲染模板</h4><p>从结构上讲，poemmaker.py和第一章中的例子很相似。我们定义了几个RequestHandler子类并把它们传给tornado.web.Application对象。那么有什么不一样的地方呢？首先，我们向Application对象的<strong>init</strong>方法传递了一个template_path参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">template_path=os.path.join(os.path.dirname(__file__), &quot;templates&quot;)</span><br></pre></td></tr></table></figure>
<p>template_path参数告诉Tornado在哪里寻找模板文件。我们将在本章和第三章中讲解其确切性质和语法，而它的基本要点是：模板是一个允许你嵌入Python代码片段的HTML文件。上面的代码告诉Python在你Tornado应用文件同目录下的templates文件夹中寻找模板文件</p>
<p>一旦我们告诉Tornado在哪里找到模板，我们可以使用RequestHandler类的render方法来告诉Tornado读入模板文件，插入其中的模版代码，并返回结果给浏览器。比如，在IndexHandler中，我们发现了下面的语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.render(&apos;index.html&apos;)</span><br></pre></td></tr></table></figure>
<p>这段代码告诉Tornado在templates文件夹下找到一个名为index.html的文件，读取其中的内容，并且发送给浏览器。</p>
<h4 id="2-1-2-填充"><a href="#2-1-2-填充" class="headerlink" title="2.1.2 填充"></a>2.1.2 填充</h4><p>实际上index.html完全不能称之为”模板”，它所包含的完全是已编写好的HTML标记。这可以是模板的一个不错的使用方式，但在更通常的情况下我们希望HTML输出可以结合我们的程序传入给模板的值。模板poem.html使用PoemPageHandler渲染，是这种方式的一个很好的例子。让我们看看它是如何工作的吧。</p>
<p>在poem.html中，你可以看到模板中有一些被双大括号（）括起来的字符串，就像这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;Two &#123;&#123;roads&#125;&#125; diverged in a &#123;&#123;wood&#125;&#125;, and I—&lt;br/&gt;</span><br><span class="line">I took the one less travelled by,&lt;br&gt;</span><br><span class="line">And that has &#123;&#123;made&#125;&#125; all the &#123;&#123;difference&#125;&#125;.&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<p>在双大括号中的单词是占位符，当我们渲染模板时希望以实际值代替。我们可以使用向render函数中传递关键字参数的方法指定什么值将被填充到HTML文件中的对应位置，其中关键字对应模板文件中占位符的名字。下面是在PoemPageHandler中相应的代码部分：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">noun1 = self.get_argument(&apos;noun1&apos;)</span><br><span class="line">noun2 = self.get_argument(&apos;noun2&apos;)</span><br><span class="line">verb = self.get_argument(&apos;verb&apos;)</span><br><span class="line">noun3 = self.get_argument(&apos;noun3&apos;)</span><br><span class="line">self.render(&apos;poem.html&apos;, roads=noun1, wood=noun2, made=verb, difference=noun3)</span><br></pre></td></tr></table></figure>
<p>在这里，我们告诉模板使用变量noun1（该变量是从get_argument方法取得的）作为模板中roads的值，noun2作为模板中wood的值，依此类推。假设用户在表单中按顺序键入了pineapples、grandfather clock、irradiated和supernovae，那么结果HTML将会如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;Two pineapples diverged in a grandfather clock, and I—&lt;br&gt;</span><br><span class="line">I took the one less travelled by,&lt;br&gt;</span><br><span class="line">And that has irradiated all the supernovae.&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<h2 id="2-2-模板语法"><a href="#2-2-模板语法" class="headerlink" title="2.2 模板语法"></a>2.2 模板语法</h2><p>既然我们已经看到了一个模板在实际应用中的简单例子，那么让我们深入地了解它们是如何工作的吧。Tornado模板是被Python表达式和控制语句标记的简单文本文件。Tornado的语法非常简单直接。熟悉Django、Liquid或其他相似框架的用户会发现它们非常相似，很容易学会。</p>
<p>在2.1节中，我们展示了如何在一个Web应用中使用render方法传送HTML给浏览器。你可以在Tornado应用之外使用Python解释器导入模板模块尝试模板系统，此时结果会被直接输出出来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from tornado.template import Template</span><br><span class="line">&gt;&gt;&gt; content = Template(&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;&#123;&#123; header &#125;&#125;&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;)</span><br><span class="line">&gt;&gt;&gt; print content.generate(header=&quot;Welcome!&quot;)</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Welcome!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-1-填充表达式"><a href="#2-2-1-填充表达式" class="headerlink" title="2.2.1 填充表达式"></a>2.2.1 填充表达式</h4><p>在代码清单2-1中，我们演示了填充Python变量的值到模板的双大括号中的使用。实际上，你可以将任何Python表达式放在双大括号中。Tornado将插入一个包含任何表达式计算结果值的字符串到输出中。下面是几个可能的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from tornado.template import Template</span><br><span class="line">&gt;&gt;&gt; print Template(&quot;&#123;&#123; 1+1 &#125;&#125;&quot;).generate()</span><br><span class="line">2</span><br><span class="line">&gt;&gt;&gt; print Template(&quot;&#123;&#123; &apos;scrambled eggs&apos;[-4:] &#125;&#125;&quot;).generate()</span><br><span class="line">eggs</span><br><span class="line">&gt;&gt;&gt; print Template(&quot;&#123;&#123; &apos;, &apos;.join([str(x*x) for x in range(10)]) &#125;&#125;&quot;).generate()</span><br><span class="line">0, 1, 4, 9, 16, 25, 36, 49, 64, 81</span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-控制流语句"><a href="#2-2-2-控制流语句" class="headerlink" title="2.2.2 控制流语句"></a>2.2.2 控制流语句</h4><p>你同样可以在Tornado模板中使用Python条件和循环语句。控制语句以{\%和\%}包围，并以类似下面的形式被使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if len(entries) == 3 %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>
<p>控制语句的大部分就像对应的Python语句一样工作，支持if、for、while和try。在这些情况下，语句块以{\%开始，并以\%}结束。</p>
<p>所以这个模板：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;&#123;&#123; title &#125;&#125;&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;&#123;&#123; header &#125;&#125;&lt;/h1&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &#123;% for book in books %&#125;</span><br><span class="line">                &lt;li&gt;&#123;&#123; book &#125;&#125;&lt;/li&gt;</span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>当被下面这个处理函数调用时：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class BookHandler(tornado.web.RequestHandler):</span><br><span class="line">    def get(self):</span><br><span class="line">        self.render(</span><br><span class="line">            &quot;book.html&quot;,</span><br><span class="line">            title=&quot;Home Page&quot;,</span><br><span class="line">            header=&quot;Books that are great&quot;,</span><br><span class="line">            books=[</span><br><span class="line">                &quot;Learning Python&quot;,</span><br><span class="line">                &quot;Programming Collective Intelligence&quot;,</span><br><span class="line">                &quot;Restful Web Services&quot;</span><br><span class="line">            ]</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<p>将会渲染得到下面的输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Home Page&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;Books that are great&lt;/h1&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &lt;li&gt;Learning Python&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;Programming Collective Intelligence&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;Restful Web Services&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>不像许多其他的Python模板系统，Tornado模板语言的一个最好的东西是在if和for语句块中可以使用的表达式没有限制。因此，你可以在你的模板中执行所有的Python代码。</p>
<p>同样，你也可以在你的控制语句块中间使用{\% set foo = ‘bar’ \%}来设置变量。你还有很多可以在控制语句块中做的事情，但是在大多数情况下，你最好使用UI模块来做更复杂的划分。我们稍后会更详细的看到这一点。</p>
<h4 id="2-2-3-在模板中使用函数"><a href="#2-2-3-在模板中使用函数" class="headerlink" title="2.2.3 在模板中使用函数"></a>2.2.3 在模板中使用函数</h4><p>Tornado在所有模板中默认提供了一些便利的函数。它们包括：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">escape(s)</span><br></pre></td></tr></table></figure>
<p>替换字符串s中的&amp;、&lt;、&gt;为他们对应的HTML字符。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url_escape(s)</span><br></pre></td></tr></table></figure>
<p>使用urllib.quote_plus替换字符串s中的字符为URL编码形式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json_encode(val)</span><br></pre></td></tr></table></figure>
<p>将val编码成JSON格式。（在系统底层，这是一个对json库的dumps函数的调用。查阅相关的文档以获得更多关于该函数接收和返回参数的信息。）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">squeeze(s)</span><br></pre></td></tr></table></figure>
<p>过滤字符串s，把连续的多个空白字符替换成一个空格。</p>
<p>在Tornado 1.x中，模版不是被自动转义的。在Tornado 2.0中，模板被默认为自动转义（并且可以在Application构造函数中使用autoscaping=None关闭）。在不同版本的迁移时要注意向后兼容。</p>
<p>在模板中使用一个你自己编写的函数也是很简单的：只需要将函数名作为模板的参数传递即可，就像其他变量一样。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from tornado.template import Template</span><br><span class="line">&gt;&gt;&gt; def disemvowel(s):</span><br><span class="line">...     return &apos;&apos;.join([x for x in s if x not in &apos;aeiou&apos;])</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; disemvowel(&quot;george&quot;)</span><br><span class="line">&apos;grg&apos;</span><br><span class="line">&gt;&gt;&gt; print Template(&quot;my name is &#123;&#123;d(&apos;mortimer&apos;)&#125;&#125;&quot;).generate(d=disemvowel)</span><br><span class="line">my name is mrtmr</span><br></pre></td></tr></table></figure>
<h2 id="2-3-复杂示例：The-Alpha-Munger"><a href="#2-3-复杂示例：The-Alpha-Munger" class="headerlink" title="2.3 复杂示例：The Alpha Munger"></a>2.3 复杂示例：The Alpha Munger</h2><p>在代码清单2-4中，我们把在这一章中谈论过的所有东西都放了进来。这个应用被称为The Alpha Munger。用户输入两个文本：一个”源”文本和一个”替代”文本。应用会返回替代文本的一个副本，并将其中每个单词替换成源文本中首字母相同的某个单词。图2-3展示了要填的表单，图2-4展示了结果文本。</p>
<p>这个应用包括四个文件：main.py（Tornado程序）、style.css（CSS样式表文件）、index.html和munged.html（Tornado模板）。让我们看看代码吧：</p>
<p><em>代码清单2-4 复杂表单和模板：main.py</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">import os.path</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line">import tornado.httpserver</span><br><span class="line">import tornado.ioloop</span><br><span class="line">import tornado.options</span><br><span class="line">import tornado.web</span><br><span class="line"></span><br><span class="line">from tornado.options import define, options</span><br><span class="line">define(&quot;port&quot;, default=8000, help=&quot;run on the given port&quot;, type=int)</span><br><span class="line"></span><br><span class="line">class IndexHandler(tornado.web.RequestHandler):</span><br><span class="line">    def get(self):</span><br><span class="line">        self.render(&apos;index.html&apos;)</span><br><span class="line"></span><br><span class="line">class MungedPageHandler(tornado.web.RequestHandler):</span><br><span class="line">    def map_by_first_letter(self, text):</span><br><span class="line">        mapped = dict()</span><br><span class="line">        for line in text.split(&apos;\r\n&apos;):</span><br><span class="line">            for word in [x for x in line.split(&apos; &apos;) if len(x) &gt; 0]:</span><br><span class="line">                if word[0] not in mapped: mapped[word[0]] = []</span><br><span class="line">                mapped[word[0]].append(word)</span><br><span class="line">        return mapped</span><br><span class="line"></span><br><span class="line">    def post(self):</span><br><span class="line">        source_text = self.get_argument(&apos;source&apos;)</span><br><span class="line">        text_to_change = self.get_argument(&apos;change&apos;)</span><br><span class="line">        source_map = self.map_by_first_letter(source_text)</span><br><span class="line">        change_lines = text_to_change.split(&apos;\r\n&apos;)</span><br><span class="line">        self.render(&apos;munged.html&apos;, source_map=source_map, change_lines=change_lines,</span><br><span class="line">                choice=random.choice)</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    tornado.options.parse_command_line()</span><br><span class="line">    app = tornado.web.Application(</span><br><span class="line">        handlers=[(r&apos;/&apos;, IndexHandler), (r&apos;/poem&apos;, MungedPageHandler)],</span><br><span class="line">        template_path=os.path.join(os.path.dirname(__file__), &quot;templates&quot;),</span><br><span class="line">        static_path=os.path.join(os.path.dirname(__file__), &quot;static&quot;),</span><br><span class="line">        debug=True</span><br><span class="line">    )</span><br><span class="line">    http_server = tornado.httpserver.HTTPServer(app)</span><br><span class="line">    http_server.listen(options.port)</span><br><span class="line">    tornado.ioloop.IOLoop.instance().start()</span><br></pre></td></tr></table></figure>
<p>记住Application构造函数中的static_path参数。我们将在下面进行详细的介绍，但是现在你所需要知道的就是static_path参数指定了你应用程序放置静态资源（如图像、CSS文件、JavaScript文件等）的目录。另外，你还需要在templates文件夹下添加index.html和munged.html这两个文件。</p>
<p><em>代码清单2-5 Alpha Munger表单：index.html</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;&#123; static_url(&quot;style.css&quot;) &#125;&#125;&quot;&gt;</span><br><span class="line">        &lt;title&gt;The Alpha Munger&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;The Alpha Munger&lt;/h1&gt;</span><br><span class="line">        &lt;p&gt;Enter two texts below. The replacement text will have its words</span><br><span class="line">            replaced by words beginning with the same letter in the source text.&lt;/p&gt;</span><br><span class="line">        &lt;form method=&quot;post&quot; action=&quot;/poem&quot;&gt;</span><br><span class="line">        &lt;p&gt;Source text&lt;br&gt;</span><br><span class="line">            &lt;textarea rows=4 cols=55 name=&quot;source&quot;&gt;&lt;/textarea&gt;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;Text for replacement&lt;br&gt;</span><br><span class="line">            &lt;textarea rows=4 cols=55 name=&quot;change&quot;&gt;&lt;/textarea&gt;&lt;/p&gt;</span><br><span class="line">        &lt;input type=&quot;submit&quot;&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><em>代码清单2-6 Alpha Munger模板：munged.html</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;&#123; static_url(&quot;style.css&quot;) &#125;&#125;&quot;&gt;</span><br><span class="line">        &lt;title&gt;The Alpha Munger&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;Your text&lt;/h1&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">&#123;% for line in change_lines %&#125;</span><br><span class="line">    &#123;% for word in line.split(&apos; &apos;) %&#125;</span><br><span class="line">        &#123;% if len(word) &gt; 0 and word[0] in source_map %&#125;</span><br><span class="line">            &lt;span class=&quot;replaced&quot;</span><br><span class="line">                    title=&quot;&#123;&#123;word&#125;&#125;&quot;&gt;&#123;&#123; choice(source_map[word[0]]) &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &#123;% else %&#125;</span><br><span class="line">            &lt;span class=&quot;unchanged&quot; title=&quot;unchanged&quot;&gt;&#123;&#123;word&#125;&#125;&lt;/span&gt;</span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">            &lt;br&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>最后，将代码清单2-7中的内容写到static子目录下的style.css文件中。</p>
<p><em>代码清单2-7 Alpha Munger样式表：style.css</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">body &#123;</span><br><span class="line">    font-family: Helvetica,Arial,sans-serif;</span><br><span class="line">    width: 600px;</span><br><span class="line">    margin: 0 auto;</span><br><span class="line">&#125;</span><br><span class="line">.replaced:hover &#123; color: #00f; &#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-1-它如何工作"><a href="#2-3-1-它如何工作" class="headerlink" title="2.3.1 它如何工作"></a>2.3.1 它如何工作</h4><p>这个Tornado应用定义了两个请求处理类：IndexHandler和MungedPageHandler。IndexHandler类简单地渲染了index.html中的模板，其中包括一个允许用户POST一个源文本（在source域中）和一个替换文本（在change域中）到/poem的表单。</p>
<p>MungedPageHandler类用于处理到/poem的POST请求。当一个请求到达时，它对传入的数据进行一些基本的处理，然后为浏览器渲染模板。map_by_first_letter方法将传入的文本（从source域）分割成单词，然后创建一个字典，其中每个字母表中的字母对应文本中所有以其开头的单词（我们将其放入一个叫作source_map的变量）。再把这个字典和用户在替代文本（表单的change域）中指定的内容一起传给模板文件munged.html。此外，我们还将Python标准库的random.choice函数传入模板，这个函数以一个列表作为输入，返回列表中的任一元素。</p>
<p>在munged.html中，我们迭代替代文本中的每行，再迭代每行中的每个单词。如果当前单词的第一个字母是source_map字典的一个键，我们使用random.choice函数从字典的值中随机选择一个单词并展示它。如果字典的键中没有这个字母，我们展示源文本中的原始单词。每个单词包括一个span标签，其中的class属性指定这个单词是替换后的（class=”replaced”）还是原始的（class=”unchanged”）。（我们还将原始单词放到了span标签的title属性中，以便于用户在鼠标经过单词时可以查看是什么单词被替代了。你可以在图2-5中看到这个动作。）</p>
<p>在这个例子中，你可能注意到了debug=True的使用。它调用了一个便利的测试模式：tornado.autoreload模块，此时，一旦主要的Python文件被修改，Tornado将会尝试重启服务器，并且在模板改变时会进行刷新。对于快速改变和实时更新这非常棒，但不要再生产上使用它，因为它将防止Tornado缓存模板！</p>
<h4 id="2-3-2-提供静态文件"><a href="#2-3-2-提供静态文件" class="headerlink" title="2.3.2 提供静态文件"></a>2.3.2 提供静态文件</h4><p>当编写Web应用时，你总希望提供像样式表、JavaScript文件和图像这样不需要为每个文件编写独立处理函数的”静态内容”。Tornado提供了几个有用的捷径来使其变得容易。</p>
<h5 id="2-3-2-1-设置静态路径"><a href="#2-3-2-1-设置静态路径" class="headerlink" title="2.3.2.1 设置静态路径"></a>2.3.2.1 设置静态路径</h5><p>你可以通过向Application类的构造函数传递一个名为static_path的参数来告诉Tornado从文件系统的一个特定位置提供静态文件。Alpha Munger中的相关代码片段如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app = tornado.web.Application(</span><br><span class="line">    handlers=[(r&apos;/&apos;, IndexHandler), (r&apos;/poem&apos;, MungedPageHandler)],</span><br><span class="line">    template_path=os.path.join(os.path.dirname(__file__), &quot;templates&quot;),</span><br><span class="line">    static_path=os.path.join(os.path.dirname(__file__), &quot;static&quot;),</span><br><span class="line">    debug=True</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>在这里，我们设置了一个当前应用目录下名为static的子目录作为static_path的参数。现在应用将以读取static目录下的filename.ext来响应诸如/static/filename.ext的请求，并在响应的主体中返回。</p>
<h5 id="2-3-2-2-使用static-url生成静态URL"><a href="#2-3-2-2-使用static-url生成静态URL" class="headerlink" title="2.3.2.2 使用static_url生成静态URL"></a>2.3.2.2 使用static_url生成静态URL</h5><p>Tornado模板模块提供了一个叫作static_url的函数来生成static目录下文件的URL。让我们来看看在index.html中static_url的调用的示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;&#123; static_url(&quot;style.css&quot;) &#125;&#125;&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>这个对static_url的调用生成了URL的值，并渲染输出类似下面的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;/static/style.css?v=ab12&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>那么为什么使用static_url而不是在你的模板中硬编码呢？有如下几个原因。其一，static_url函数创建了一个基于文件内容的hash值，并将其添加到URL末尾（查询字符串的参数v）。这个hash值确保浏览器总是加载一个文件的最新版而不是之前的缓存版本。无论是在你应用的开发阶段，还是在部署到生产环境使用时，都非常有用，因为你的用户不必再为了看到你的静态内容而清除浏览器缓存了。</p>
<p>另一个好处是你可以改变你应用URL的结构，而不需要改变模板中的代码。例如，你可以配置Tornado响应来自像路径/s/filename.ext的请求时提供静态内容，而不是默认的/static路径。如果你使用static_url而不是硬编码的话，你的代码不需要改变。比如说，你想把静态资源从我们刚才使用的/static目录移到新的/s目录。你可以简单地改变静态路径由static变为s，然后每个使用static_url包裹的引用都会被自动更新。如果你在每个引用静态资源的文件中硬编码静态路径部分，你将不得不手动修改每个模板。</p>
<h4 id="2-3-3-模板的下一步"><a href="#2-3-3-模板的下一步" class="headerlink" title="2.3.3 模板的下一步"></a>2.3.3 模板的下一步</h4><p>到目前为止，你已经能够处理Tornado模板系统的简单功能了。对于像Alpha Munger这样简单的Web应用而言，基础的功能对你而言足够用了。但是我们在模板部分的学习并没有结束。Tornado在块和模块的形式上仍然有一些技巧，这两个功能使得编写和维护复杂的Web应用更加简单。我们将在第三章中看到这些功能。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tonytan748.github.io/2016/03/08/tornado-web-framework-2/" data-id="cm50h3r9k0041yfhtayleyvof" class="article-share-link">Share</a>
      
        <a href="https://tonytan748.github.io/2016/03/08/tornado-web-framework-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/7/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/9/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Github/">Github</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Karrigell/">Karrigell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/VIM/">VIM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/conda/">conda</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/django/">django</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ffmpeg/">ffmpeg</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/freeswitch/">freeswitch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/go/">go</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jekyll/">jekyll</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kivy/">kivy</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/mac/">mac</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/normal/">normal</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/sqlalchemy/">sqlalchemy</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system/">system</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tornado/">tornado</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ubuntu/">ubuntu</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/conda/">conda</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django-celery/">django-celery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ffmpeg/">ffmpeg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/">flask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/freeswitch/">freeswitch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/">mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/other/">other</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlalchemy/">sqlalchemy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/system/">system</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tornado/">tornado</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/">ubuntu</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/conda/" style="font-size: 10px;">conda</a> <a href="/tags/django/" style="font-size: 18px;">django</a> <a href="/tags/django-celery/" style="font-size: 10px;">django-celery</a> <a href="/tags/ffmpeg/" style="font-size: 10px;">ffmpeg</a> <a href="/tags/flask/" style="font-size: 10px;">flask</a> <a href="/tags/freeswitch/" style="font-size: 10px;">freeswitch</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/go/" style="font-size: 14px;">go</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/linux/" style="font-size: 16px;">linux</a> <a href="/tags/mac/" style="font-size: 10px;">mac</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/other/" style="font-size: 12px;">other</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/sqlalchemy/" style="font-size: 10px;">sqlalchemy</a> <a href="/tags/system/" style="font-size: 12px;">system</a> <a href="/tags/tornado/" style="font-size: 10px;">tornado</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">December 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">June 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">September 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/12/23/Python-Typing类型提示/">Python Typing类型提示</a>
          </li>
        
          <li>
            <a href="/2024/12/23/Python-Tempfile临时文件系统对象/">Python Tempfile临时文件系统对象</a>
          </li>
        
          <li>
            <a href="/2024/12/23/Python-Pathlib处理文件路径库的使用/">Python Pathlib处理文件路径库的使用</a>
          </li>
        
          <li>
            <a href="/2024/08/31/在ubuntu上的18个非常实用的命令行工具软件/">在ubuntu上的18个非常实用的命令行工具软件</a>
          </li>
        
          <li>
            <a href="/2024/08/20/什么是动态规划？在Python中如何利用动态规划解决实际问题？/">什么是动态规划？在Python中如何利用动态规划解决实际问题？</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2024 Tony Tan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'TonyTan';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>